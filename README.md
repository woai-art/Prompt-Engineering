# Prompt Engineering

Автор: Lee Boonstra

---
## Благодарности

**Авторы контента**
*   Michael Sherman
*   Yuan Cao
*   Erick Armbrust
*   Anant Nawalgaria
*   Antonio Gulli
*   Simone Cammel

**Кураторы и Редакторы**
*   Antonio Gulli
*   Anant Nawalgaria
*   Grace Mollison

**Технический писатель**
*   Joey Haymaker

**Дизайнер**
*   Michael Lanning

---
*Prompt Engineering*
*Февраль 2025*
## Содержание

*   Введение (6)
*   `Prompt engineering` (7)
*   Конфигурация вывода `LLM` (8)
    *   Длина вывода (8)
    *   Управление `сэмплингом` (9)
        *   `Температура` (9)
        *   `Top-K` и `top-P` (10)
    *   Собираем все вместе (11)
*   Техники `промптинга` (13)
    *   Общий `промптинг` / `zero-shot` (13)
    *   `One-shot` и `few-shot` (15)
    *   Системный, контекстуальный и ролевой `промптинг` (18)
        *   Системный `промптинг` (19)
        *   Ролевой `промптинг` (21)
        *   Контекстуальный `промптинг` (23)
    *   `Step-back prompting` (25)
    *   `Chain of Thought` (`CoT`) (29)
    *   `Self-consistency` (32)
    *   `Tree of Thoughts` (`ToT`) (36)
    *   `ReAct` (reason & act) (37)
    *   `Automatic Prompt Engineering` (40)
    *   `Code prompting` (42)
        *   Промпты для написания кода (42)
        *   Промпты для объяснения кода (44)
        *   Промпты для перевода кода (46)
        *   Промпты для отладки и ревью кода (48)
    *   Что насчет мультимодального `промптинга`? (54)
*   Лучшие практики (`Best Practices`) (54)
    *   Предоставляйте примеры (54)
    *   Простота в дизайне (55)
    *   Будьте конкретны относительно вывода (56)
    *   Используйте инструкции вместо ограничений (`Use Instructions over Constraints`) (56)
    *   Контролируйте максимальную длину в `токенах` (58)
    *   Используйте переменные в `промптах` (58)
    *   Экспериментируйте с форматами ввода и стилями написания (59)
    *   Для `few-shot промптинга` с задачами классификации, смешивайте классы (59)
    *   Адаптируйтесь к обновлениям модели (60)
    *   Экспериментируйте с форматами вывода (60)
    *   `JSON Repair` (61)
    *   Работа со `Schemas` (62)
    *   Экспериментируйте вместе с другими `prompt инженерами` (63)
    *   Лучшие практики `CoT` (64)
    *   Документируйте различные попытки `промптов` (64)
*   Резюме (66)
*   Примечания (68)
> Вам не нужно быть **data scientist** или **machine learning инженером** – каждый может написать **промпт**.

## Введение

Когда речь идет о вводе и выводе большой языковой модели (`large language model`), текстовый `промпт` (иногда сопровождаемый другими модальностями, такими как `image prompts` — промпты для изображений) является входными данными, которые модель использует для предсказания конкретного вывода. Вам не нужно быть `data scientist` или `machine learning инженером` – каждый может написать `промпт`.

Однако создание наиболее эффективного `промпта` может быть сложным. Многие аспекты вашего `промпта` влияют на его эффективность: используемая модель, обучающие данные (`training data`) модели, конфигурации модели, ваш выбор слов, стиль и тон, структура и контекст – все это имеет значение. Поэтому `prompt engineering` – это итеративный процесс. Неадекватные `промпты` могут приводить к двусмысленным, неточным ответам и могут мешать способности модели предоставлять осмысленный вывод.
Когда вы общаетесь с чат-ботом `Gemini`¹, вы, по сути, пишете `промпты`. Однако этот документ (`whitepaper`) сфокусирован на написании `промптов` для модели `Gemini` в рамках `Vertex AI` или через `API`, поскольку, `промптуя` модель напрямую, вы получаете доступ к конфигурации (`configuration`), такой как `температура` (`temperature`) и т. д.

Этот `whitepaper` подробно обсуждает `prompt engineering`. Мы рассмотрим различные техники `промптинга` (`prompting techniques`), чтобы помочь вам начать работу, и поделимся советами и лучшими практиками (`best practices`), чтобы стать экспертом в `промптинге` (`prompting expert`). Мы также обсудим некоторые сложности, с которыми вы можете столкнуться при создании `промптов`.

---

## Prompt engineering

Вспомните, как работает `LLM`: это механизм предсказания (`prediction engine`). Модель принимает последовательный текст (`sequential text`) в качестве входных данных, а затем предсказывает, каким должен быть следующий `токен` (`token`), основываясь на данных, на которых она была обучена (`trained`). `LLM` операционализирована для выполнения этого снова и снова, добавляя ранее предсказанный `токен` к концу последовательного текста для предсказания следующего `токена`. Предсказание следующего `токена` основано на взаимосвязи между тем, что находится в предыдущих `токенах`, и тем, что `LLM` видела во время своего обучения (`training`).

Когда вы пишете `промпт`, вы пытаетесь настроить `LLM` на предсказание правильной последовательности `токенов`. `Prompt engineering` — это процесс разработки высококачественных `промптов`, которые направляют `LLM` для получения точных выводов. Этот процесс включает в себя подбор (`tinkering`) для поиска наилучшего `промпта`, оптимизацию длины `промпта`, а также оценку стиля написания и структуры `промпта` в соответствии с задачей. В контексте обработки естественного языка (`natural language processing`) и `LLM`, `промпт` — это входные данные, предоставляемые модели для генерации ответа или предсказания.
Эти `промпты` могут использоваться для достижения различных видов задач понимания и генерации, таких как `суммаризация текста` (`text summarization`), `извлечение информации` (`information extraction`), `ответы на вопросы` (`question and answering`), `классификация текста` (`text classification`), `перевод языка или кода` (`language or code translation`), `генерация кода` (`code generation`), `документирование кода` (`code documentation`) или `рассуждения` (`reasoning`).

Не стесняйтесь обращаться к руководствам по `промптингу` от Google²˒³ с простыми и эффективными примерами `промптинга`.

При `prompt engineering` вы начнете с выбора модели. `Промпты`, возможно, потребуется оптимизировать для вашей конкретной модели, независимо от того, используете ли вы языковые модели `Gemini` в `Vertex AI`, `GPT`, `Claude` или `open source` модель, такую как `Gemma` или `LLaMA`.

Помимо `промпта`, вам также нужно будет экспериментировать (`tinker`) с различными конфигурациями (`configurations`) `LLM`.

---

## Конфигурация вывода LLM (`LLM output configuration`)

После того как вы выберете модель, вам нужно будет разобраться с конфигурацией модели (`model configuration`). Большинство `LLM` поставляются с различными опциями конфигурации (`configuration options`), которые контролируют вывод (`output`) `LLM`. Эффективный `prompt engineering` требует оптимальной настройки этих конфигураций для вашей задачи.

### Длина вывода (`Output length`)

Важный параметр конфигурации (`configuration setting`) — это количество `токенов` (`tokens`), которые нужно сгенерировать в ответе. Генерация большего количества `токенов` требует больших вычислений (`computation`) от `LLM`, что приводит к более высокому потреблению энергии (`energy consumption`), потенциально более медленному времени ответа (`response times`) и более высоким затратам (`costs`).
Уменьшение длины вывода (`output length`) `LLM` не приводит к тому, что `LLM` становится более стилистически или текстуально лаконичной в создаваемом ею выводе; это просто заставляет `LLM` прекратить предсказывать больше `токенов` (`tokens`), как только достигнут лимит. Если ваши потребности требуют короткой длины вывода, вам, возможно, также потребуется спроектировать (`engineer`) ваш `промпт` (`prompt`) для этого.

Ограничение длины вывода особенно важно для некоторых техник `промптинга` `LLM`, таких как `ReAct`, где `LLM` будет продолжать генерировать бесполезные `токены` после того, как нужный вам ответ уже получен.

Помните, что генерация большего количества `токенов` требует больших вычислений от `LLM`, что приводит к более высокому потреблению энергии и потенциально более медленному времени ответа, что ведет к более высоким затратам.

---

### Управление сэмплингом (`Sampling controls`)

`LLM` формально не предсказывают один единственный `токен`. Скорее, `LLM` предсказывают вероятности (`probabilities`) того, каким может быть следующий `токен`, причем каждый `токен` в словаре (`vocabulary`) `LLM` получает свою вероятность. Затем эти вероятности `токенов` сэмплируются (`sampled`), чтобы определить, какой `токен` будет сгенерирован следующим. `Температура` (`Temperature`), `top-K` и `top-P` являются наиболее распространенными настройками конфигурации (`configuration settings`), которые определяют, как обрабатываются предсказанные вероятности `токенов` для выбора одного выходного `токена`.

#### Температура (`Temperature`)

`Температура` контролирует степень случайности (`randomness`) при выборе `токенов` (`token selection`). Более низкие `температуры` хороши для `промптов`, которые ожидают более детерминированного (`deterministic`) ответа, в то время как более высокие `температуры` могут привести к более разнообразным (`diverse`) или неожиданным результатам. `Температура` 0 (жадное декодирование - `greedy decoding`) детерминированный: всегда выбирается `токен` (`token`) с наивысшей вероятностью (хотя обратите внимание, что если два `токена` имеют одинаковую наивысшую предсказанную вероятность, в зависимости от реализации разрешения конфликтов (`tiebreaking`), вы не всегда можете получить тот же вывод при `температуре` 0).

`Температуры`, близкие к максимальной, имеют тенденцию создавать более случайный вывод (`random output`). И по мере того, как `температура` становится все выше и выше, все `токены` становятся одинаково вероятными (`equally likely`) для выбора в качестве следующего предсказанного `токена`.

Управление `температурой` в `Gemini` можно понять аналогично функции `softmax`, используемой в `машинном обучении` (`machine learning`). Низкая настройка `температуры` отражает низкую `температуру` `softmax` (T), подчеркивая единственную предпочтительную `температуру` с высокой уверенностью (`high certainty`). Более высокая настройка `температуры` `Gemini` подобна высокой `температуре` `softmax`, делая более широкий диапазон `температур` вокруг выбранной настройки более приемлемым. Эта повышенная неопределенность (`uncertainty`) подходит для сценариев, где жесткая, точная `температура` может быть не важна, например, при экспериментировании с творческими (`creative`) выводами.

---

#### Top-K и top-P

`Top-K` и `top-P` (также известные как ядерный сэмплинг - `nucleus sampling`)⁴ — это две настройки `сэмплинга` (`sampling settings`), используемые в `LLM` для ограничения выбора следующего предсказанного `токена` только теми `токенами`, которые имеют наивысшие предсказанные вероятности (`top predicted probabilities`). Подобно `температуре`, эти настройки `сэмплинга` контролируют случайность (`randomness`) и разнообразие (`diversity`) генерируемого текста.

*   **`Top-K` сэмплинг** выбирает `top K` наиболее вероятных `токенов` из предсказанного распределения (`predicted distribution`) модели. Чем выше `top-K`, тем более креативным и разнообразным будет вывод модели; чем ниже `top-K`, тем более ограниченным и фактологичным будет вывод модели. `Top-K`, равный 1, эквивалентен жадному декодированию (`greedy decoding`).
*   **`Top-P` сэмплинг** выбирает наиболее вероятные `токены`, чья кумулятивная вероятность (`cumulative probability`) не превышает определенного значения (P). Значения P варьируются от 0 (`greedy decoding`) до 1 (все `токены` в словаре `LLM`).

Лучший способ выбрать между `top-K` и `top-P` — это поэкспериментировать с обоими методами (или с их комбинацией) и посмотреть, какой из них дает искомые результаты.

---

### Собираем все вместе (`Putting it all together`)

Выбор между `top-K`, `top-P`, `температурой` и количеством `токенов` для генерации зависит от конкретного приложения (`application`) и желаемого результата (`desired outcome`), и все настройки влияют друг на друга. Также важно убедиться, что вы понимаете, как ваша выбранная модель (`chosen model`) комбинирует различные настройки `сэмплинга` (`sampling settings`) вместе.

Если `температура`, `top-K` и `top-P` все доступны (как в `Vertex Studio`), `токены`, удовлетворяющие критериям и `top-K`, и `top-P`, являются кандидатами (`candidates`) для следующего предсказанного `токена`, а затем применяется `температура` для `сэмплирования` (`sample`) из `токенов`, прошедших критерии `top-K` и `top-P`. Если доступен только `top-K` или `top-P`, поведение (`behavior`) такое же, но используется только одна настройка — `top-K` или `P`.

Если `температура` недоступна, то `токены`, удовлетворяющие критериям `top-K` и/или `top-P`, затем случайным образом выбираются для получения одного следующего предсказанного `токена`.

При экстремальных значениях (`extreme settings`) одного параметра конфигурации `сэмплинга`, этот параметр либо отменяет (`cancels out`) другие настройки конфигурации, либо становится нерелевантным (`irrelevant`).
*   Если вы установите `температуру` (`temperature`) на 0, `top-K` и `top-P` станут нерелевантными — наиболее вероятный `токен` (`token`) становится следующим предсказанным `токеном`. Если вы установите `температуру` чрезвычайно высокой (выше 1, обычно в районе 10 и выше), `температура` становится нерелевантной, и любые `токены`, прошедшие через критерии `top-K` и/или `top-P`, затем случайным образом `сэмплируются` для выбора следующего предсказанного `токена`.

*   Если вы установите `top-K` на 1, `температура` и `top-P` станут нерелевантными. Только один `токен` проходит критерий `top-K`, и этот `токен` является следующим предсказанным `токеном`. Если вы установите `top-K` чрезвычайно высоким, сравнимым с размером словаря `LLM` (`LLM's vocabulary`), любой `токен` с ненулевой вероятностью (`nonzero probability`) быть следующим `токеном` будет соответствовать критериям `top-K`, и ни один из них не будет отсеян.

*   Если вы установите `top-P` на 0 (или очень малое значение), большинство реализаций `сэмплинга` `LLM` (`LLM sampling implementations`) будут рассматривать только наиболее вероятный `токен`, чтобы соответствовать критериям `top-P`, делая `температуру` и `top-K` нерелевантными. Если вы установите `top-P` на 1, любой `токен` с ненулевой вероятностью быть следующим `токеном` будет соответствовать критериям `top-P`, и ни один из них не будет отсеян.

В качестве общей отправной точки, `температура` 0.2, `top-P` 0.95 и `top-K` 30 дадут вам относительно связные (`coherent`) результаты, которые могут быть творческими (`creative`), но не чрезмерно. Если вы хотите особенно творческих результатов, попробуйте начать с `температуры` 0.9, `top-P` 0.99 и `top-K` 40. А если вы хотите менее творческих результатов, попробуйте начать с `температуры` 0.1, `top-P` 0.9 и `top-K` 20. Наконец, если ваша задача всегда имеет единственный правильный ответ (например, решение математической задачи), начните с `температуры` 0.

**ПРИМЕЧАНИЕ:** С большей свободой (более высокая `температура`, `top-K`, `top-P` и выходные `токены`), `LLM` может генерировать текст, который менее релевантен.

**ПРЕДУПРЕЖДЕНИЕ:** Вы когда-нибудь видели ответ, заканчивающийся большим количеством слов-заполнителей (`filler words`)? Это также известно как "баг петли повторения" (`repetition loop bug`), что является распространенной проблемой в Больших Языковых Моделях (`Large Language Models`), когда модель застревает в цикле, многократно генерируя одно и то же слово (заполнитель), фразу или структуру предложения, часто усугубляемое неподходящими настройками `температуры` и `top-K`/`top-P`. настроек `top-p`. Это может происходить как при низких, так и при высоких настройках `температуры` (`temperature settings`), хотя и по разным причинам. При низких `температурax` модель становится излишне детерминированной (`overly deterministic`), жестко придерживаясь пути наивысшей вероятности (`highest probability path`), что может привести к циклу (`loop`), если этот путь повторно посещает ранее сгенерированный текст. Наоборот, при высоких `температурах` вывод модели становится чрезмерно случайным (`excessively random`), увеличивая вероятность того, что случайно выбранное слово или фраза, по совпадению, вернут к предыдущему состоянию (`prior state`), создавая цикл из-за огромного количества доступных опций (`available options`). В обоих случаях процесс `сэмплинга` (`sampling process`) модели "застревает" (`gets "stuck"`), что приводит к монотонному и бесполезному выводу (`monotonous and unhelpful output`) до тех пор, пока окно вывода (`output window`) не будет заполнено. Решение этой проблемы часто требует тщательного подбора (`careful tinkering`) значений `температуры` и `top-k`/`top-p`, чтобы найти оптимальный баланс между детерминизмом (`determinism`) и случайностью (`randomness`).

---

## Техники промптинга (`Prompting techniques`)

`LLM` настроены (`tuned`) следовать инструкциям и обучены (`trained`) на больших объемах данных, чтобы они могли понимать `промпт` (`prompt`) и генерировать ответ. Но `LLM` не идеальны; чем четче текст вашего `промпта`, тем лучше `LLM` сможет предсказать следующий вероятный текст. Кроме того, специфические техники, использующие преимущества того, как `LLM` обучены и как они работают, помогут вам получить релевантные результаты от `LLM`.

Теперь, когда мы понимаем, что такое `prompt engineering` и что для этого требуется, давайте погрузимся в некоторые примеры наиболее важных техник `промптинга` (`prompting techniques`).

### Общий промптинг / zero-shot (`General prompting / zero shot`)

`Zero-shot`⁵ `промпт` — это простейший тип `промпта`. Он предоставляет только описание задачи (`description of a task`) и некоторый текст для `LLM`, чтобы начать работу. Эти входные данные могут быть чем угодно: вопросом, началом истории или инструкциями. Название `zero-shot` означает "без примеров" (`no examples`).
Давайте воспользуемся `Vertex AI Studio` (для Языка) в `Vertex AI`⁶, который предоставляет "песочницу" (`playground`) для тестирования `промптов` (`prompts`). В Таблице 1 вы увидите пример `zero-shot промпта` для классификации обзоров фильмов.

Табличный формат, используемый ниже, — отличный способ документирования `промптов`. Ваши `промпты`, скорее всего, пройдут через множество итераций (`iterations`), прежде чем попадут в кодовую базу (`codebase`), поэтому важно отслеживать вашу работу по `prompt engineering` дисциплинированным, структурированным образом. Больше об этом табличном формате, важности отслеживания работы по `prompt engineering` и процессе разработки `промпта` (`prompt development process`) — в разделе "Лучшие практики" (`Best Practices`) далее в этой главе ("Документируйте различные попытки `промптов`").

`Температура` модели (`model temperature`) должна быть установлена на низкое значение, поскольку креативность не требуется, и мы используем `дефолтные` значения `top-K` и `top-P` для `gemini-pro`, которые эффективно отключают обе настройки (см. 'Конфигурация вывода `LLM`' выше). Обратите внимание на сгенерированный вывод (`generated output`). Слова *disturbing* (тревожный) и *masterpiece* (шедевр) должны немного усложнить предсказание, так как оба слова используются в одном предложении.
| Name         | `1_1_movie_classification`                                                                                                                                                                                                                            |
| :----------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Goal         | Классифицировать обзоры фильмов как `positive`, `neutral` или `negative`.                                                                                                                                                                           |
| Model        | `gemini-pro`                                                                                                                                                                                                                                          |
| Temperature  | 0.1                                                                                                                                                                                                                                                   |
| Token Limit  | 5                                                                                                                                                                                                                                                     |
| Top-K        | N/A                                                                                                                                                                                                                                                   |
| Top-P        | 1                                                                                                                                                                                                                                                     |
| Prompt       | Классифицировать обзоры фильмов как `POSITIVE`, `NEUTRAL` или `NEGATIVE`. <br> Review: "Her" is a disturbing study revealing the direction humanity is headed if AI is allowed to keep evolving unchecked. I wish there were more movies like this masterpiece. <br> Sentiment: |
| Output       | `POSITIVE`                                                                                                                                                                                                                                            |

**Таблица 1.** Пример `zero-shot промптинга`

Когда `zero-shot` не работает, вы можете предоставить демонстрации или примеры в `промпте`, что ведет к `one-shot` и `few-shot промптингу`. Общий `промптинг` / `zero shot`

---

### One-shot & few-shot

При создании `промптов` для `AI` моделей полезно предоставлять примеры. Эти примеры могут помочь модели понять, что вы запрашиваете. Примеры особенно полезны, когда вы хотите направить модель на определенную структуру вывода (`output structure`) или шаблон (`pattern`).

**`One-shot промпт`** предоставляет *один* (`single`) пример, отсюда и название `one-shot`. Идея в том, что модель имеет пример, который она может имитировать для наилучшего выполнения задачи.

**`Few-shot промпт`**⁷ предоставляет *множество* (`multiple`) примеров модели. Этот подход показывает модели шаблон (`pattern`), которому нужно следовать. Идея схожа с `one-shot`, но большее количество примеров желаемого шаблона повышает вероятность того, что модель будет следовать этому шаблону.
Количество примеров, необходимых для `few-shot промптинга`, зависит от нескольких факторов, включая сложность задачи (`complexity of the task`), качество примеров (`quality of the examples`) и возможности используемой вами модели генеративного ИИ (`generative AI` (`gen AI`) `model`). Как общее правило (`general rule of thumb`), для `few-shot промптинга` следует использовать от трех до пяти примеров. Однако для более сложных задач (`complex tasks`) вам может потребоваться больше примеров, или же придется использовать меньше из-за ограничений входной длины (`input length limitation`) вашей модели.

В Таблице 2 показан пример `few-shot промпта`. Давайте используем те же настройки конфигурации модели `gemini-pro`, что и раньше, за исключением увеличения лимита `токенов` (`token limit`), чтобы учесть необходимость более длинного ответа.

|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :-------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Goal**        | Разобрать заказы пиццы в `JSON`.                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Temperature** | 0.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Token Limit** | 250                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Top-K**       | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Top-P**       | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Prompt**      | **Парсинг заказа пиццы клиента в валидный `JSON`:**<br><br>**ПРИМЕР:**<br>Я хочу маленькую пиццу с сыром, томатным соусом и пепперони.<br>**`JSON` Response:**<br>```json<br>{<br>  "size": "small",<br>  "type": "normal",<br>  "ingredients": ["cheese", "tomato sauce", "pepperoni"]<br>}<br>```<br>...<br>**ПРИМЕР:**<br>Можно мне большую пиццу с томатным соусом, базиликом и моцареллой?<br>**`JSON` Response:**<br>```json<br>{<br>  "size": "large",<br>  "type": "normal",<br>  "ingredients": ["tomato sauce", "bazel", "mozzarella"]<br>}<br>```<br>Теперь я бы хотел большую пиццу, первая половина с сыром и моцареллой. А другая с томатным соусом, ветчиной и ананасом.<br>**`JSON` Response:** |
| **Output**      | ```json<br>{<br>  "size": "large",<br>  "type": "half-half",<br>  "ingredients": [["cheese", "mozzarella"], ["tomato sauce", "ham", "pineapple"]]<br>}<br>```                                                                                                                                                                                                                                                                                                              |

**Таблица 2.** Пример `few-shot промптинга`

Когда вы выбираете примеры для вашего `промпта`, используйте примеры, которые релевантны задаче, которую вы хотите выполнить. Примеры должны быть разнообразными (`diverse`), высокого качества (`high quality`) и хорошо написанными. Одна маленькая ошибка может сбить модель с толку и привести к нежелательному выводу (`undesired output`).

Если вы пытаетесь сгенерировать вывод, который устойчив к разнообразным входным данным (`robust to a variety of inputs`), важно включать `краевые случаи` (`edge cases`) в ваши примеры. `Краевые случаи` — это входные данные, которые необычны или неожиданны (`unusual or unexpected`), но с которыми модель все равно должна уметь справляться.
## Системный, контекстуальный и ролевой промптинг (`System, contextual and role prompting`)

Системный, контекстуальный и ролевой `промптинг` — это всё техники, используемые для направления того, как `LLM` генерируют текст, но они фокусируются на разных аспектах:

*   **Системный `промптинг` (`System prompting`)** задает общий контекст и цель для языковой модели (`language model`). Он определяет "общую картину" (`big picture`) того, что должна делать модель, например, перевод языка, классификация обзора и т.д.
*   **Контекстуальный `промптинг` (`Contextual prompting`)** предоставляет специфические детали или фоновую информацию, релевантную текущему разговору или задаче. Он помогает модели понять нюансы того, что запрашивается, и соответствующим образом адаптировать ответ.
*   **Ролевой `промптинг` (`Role prompting`)** назначает специфического персонажа или идентичность для языковой модели. Это помогает модели генерировать ответы, которые согласуются с назначенной ролью и связанными с ней знаниями и поведением.

Может существовать значительное пересечение (`overlap`) между системным, контекстуальным и ролевым `промптингом`. Например, `промпт`, который назначает роль системе, также может иметь контекст.

Однако каждый тип `промпта` служит немного разной основной цели:

*   **Системный `промпт` (`System prompt`):** Определяет фундаментальные возможности (`fundamental capabilities`) модели и общую цель (`overarching purpose`).
*   **Контекстуальный `промпт` (`Contextual prompt`):** Предоставляет немедленную, специфичную для задачи (`task-specific`) информацию для направления ответа. Он очень специфичен для текущей задачи или ввода (`input`), который является динамическим (`dynamic`).
*   **Ролевой `промпт` (`Role prompt`):** Формирует стиль вывода (`output style`) и голос (`voice`) модели. Он добавляет слой специфичности (`specificity`) и индивидуальности (`personality`).
Различие между системными (`system`), контекстуальными (`contextual`) и ролевыми (`role`) `промптами` предоставляет фреймворк (`framework`) для разработки `промптов` с четким намерением (`clear intent`), допуская гибкие комбинации и облегчая анализ того, как каждый тип `промпта` влияет на вывод (`output`) языковой модели.

Давайте углубимся в эти три различных вида `промптов`.

### Системный промптинг (`System prompting`)

Таблица 3 содержит системный `промпт`, где я указываю дополнительную информацию о том, как вернуть вывод. Я увеличил `температуру` (`temperature`), чтобы получить более высокий уровень креативности (`creativity level`), и указал более высокий лимит `токенов` (`token limit`). Однако из-за моей четкой инструкции о том, как вернуть вывод, модель не вернула дополнительный текст.

|                 |                                                                                                                                                                                                                                                        |
| :-------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Goal**        | Классифицировать обзоры фильмов как `positive`, `neutral` или `negative`.                                                                                                                                                                              |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                           |
| **Temperature** | 1                                                                                                                                                                                                                                                      |
| **Token Limit** | 5                                                                                                                                                                                                                                                      |
| **Top-K**       | 40                                                                                                                                                                                                                                                     |
| **Top-P**       | 0.8                                                                                                                                                                                                                                                    |
| **Prompt**      | Классифицировать обзоры фильмов как `positive`, `neutral` или `negative`. Возвращать только метку (`label`) в верхнем регистре (`uppercase`). <br> Review: "Her" is a disturbing study revealing the direction humanity is headed if AI is allowed to keep evolving unchecked. It's so disturbing I couldn't watch it. <br> Sentiment: |
| **Output**      | `NEGATIVE`                                                                                                                                                                                                                                             |

**Таблица 3.** Пример системного `промптинга` (`system prompting`)

Системные `промпты` (`System prompts`) могут быть полезны для генерации вывода, отвечающего специфическим требованиям. Название "системный `промпт`" фактически означает "предоставление дополнительной задачи системе" (`providing an additional task to the system`). Например, вы можете использовать системный `промпт` для генерации `сниппета кода` (`code snippet`), совместимого с определенным языком программирования (`programming language`), или вы можете использовать системный `промпт` для возврата определенной структуры (`structure`). Взгляните на Таблицу 4, где я возвращаю вывод в формате `JSON`.
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| :-------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Goal**        | Классифицировать обзоры фильмов как `positive`, `neutral` или `negative`, вернуть `JSON`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Temperature** | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Top-K**       | 40                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Top-P**       | 0.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Prompt**      | Классифицировать обзоры фильмов как `positive`, `neutral` или `negative`. Вернуть валидный `JSON`. <br> Review: "Her" is a disturbing study revealing the direction humanity is headed if AI is allowed to keep evolving unchecked. It's so disturbing I couldn't watch it.<br>...<br>**Schema:**<br><br>**MOVIE:**<br>```<br>{<br>  "sentiment": String "POSITIVE" | "NEGATIVE" | "NEUTRAL",<br>  "name": String<br>}<br>```<br>**MOVIE REVIEWS:**<br>```<br>{<br>  "movie_reviews": [MOVIE]<br>}<br>```<br>...<br>**JSON Response:** |
| **Output**      | ```json<br>{<br>  "movie_reviews": [<br>    {<br>      "sentiment": "NEGATIVE",<br>      "name": "Her"<br>    }<br>  ]<br>}<br>```                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

**Таблица 4.** Пример системного `промптинга` с форматом `JSON`
Есть некоторые преимущества в возврате `JSON` объектов из `промпта`, который извлекает данные. В реальном приложении (`real-world application`) мне не нужно вручную создавать этот `JSON` формат, я могу сразу вернуть данные в отсортированном порядке (очень удобно при работе с объектами `datetime`), но самое важное — `промптинг` на формат `JSON` заставляет модель создавать структуру и ограничивает `галлюцинации` (`hallucinations`).

Системные `промпты` (`System prompts`) также могут быть очень полезны для обеспечения безопасности (`safety`) и контроля токсичности (`toxicity`). Чтобы контролировать вывод, просто добавьте дополнительную строку в ваш `промпт`, например: "Вы должны быть уважительны в своем ответе." (`You should be respectful in your answer.`).

---

### Ролевой промптинг (`Role prompting`)

Ролевой `промптинг` — это техника в `prompt engineering`, которая включает назначение специфической роли модели генеративного ИИ (`gen AI model`). Это может помочь модели генерировать более релевантный и информативный вывод, поскольку модель может создавать свои ответы в соответствии с назначенной ей специфической ролью.

Например, вы можете назначить `gen AI` модели роль редактора книги, воспитателя детского сада или мотивационного спикера. Как только модели назначена роль, вы можете давать ей `промпты`, специфичные для этой роли. Например, вы можете дать `промпт` учителю для создания плана урока (`lesson plan`), который они затем смогут проверить. Взгляните на Таблицу 5, где модель принимает роль гида (`travel guide`).
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| :-------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Goal**        | Выступать в роли гида (`travel guide`) и предоставить 3 предложения для путешествия (`travel suggestions`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Temperature** | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Top-K**       | 40                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Top-P**       | 0.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Prompt**      | Я хочу, чтобы ты выступил в роли гида (`travel guide`). Я напишу тебе о своем местоположении (`location`), и ты предложишь 3 места для посещения рядом со мной. В некоторых случаях я также укажу тип мест (`type of places`), которые я хочу посетить.<br>Мое предложение: "Я в Амстердаме и хочу посетить только музеи."<br>Предложения для путешествия (`Travel Suggestions`): |
| **Output**      | 1.  **Rijksmuseum:** Всемирно известный музей, известный голландскими шедеврами, такими как "Ночной дозор" Рембрандта. Не пропустите невероятную коллекцию картин и артефактов, демонстрирующих голландское искусство и историю.<br>2.  **Музей Ван Гога (`Van Gogh Museum`):** Погрузитесь в захватывающие работы Винсента ван Гога. В музее находится крупнейшая коллекция его картин и рисунков, включая "Звездную ночь" и "Подсолнухи".<br>3.  **Городской музей Амстердама (`Stedelijk Museum Amsterdam`):** Откройте для себя современное искусство со всего мира. Коллекция музея включает работы Пикассо, Кандинского и Ритвельда, размещенные в поразительном современном здании.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

**Таблица 5.** Пример ролевого `промптинга` (`role prompting`)

Приведенный выше пример показывает пример принятия роли турагента (`travel agent`). Если бы вы изменили роль на учителя географии, вы бы заметили, что получите другой ответ.

Определение ролевой перспективы (`role perspective`) для `AI` модели дает ей план (`blueprint`) тона (`tone`), стиля (`style`) и сфокусированной экспертизы (`focused expertise`), которые вы ищете, чтобы улучшить качество (`quality`), релевантность (`relevance`) и эффективность (`effectiveness`) вашего вывода (`output`).
Вот некоторые стили (`styles`), которые вы можете выбрать и которые я нахожу эффективными:

Конфронтационный (`Confrontational`), Описательный (`Descriptive`), Прямой (`Direct`), Формальный (`Formal`), Юмористический (`Humorous`), Влиятельный (`Influential`), Неформальный (`Informal`), Вдохновляющий (`Inspirational`), Убеждающий (`Persuasive`).

Давайте изменим наш `промпт` в Таблице 6, чтобы включить юмористический (`humorous`) и вдохновляющий (`inspirational`) стиль.

|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| :-------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt**      | Я хочу, чтобы ты выступил в роли гида (`travel guide`). Я напишу тебе о своем местоположении (`location`), и ты предложишь 3 места для посещения рядом со мной в юмористическом (`humorous`) стиле.<br>Мое предложение: "Я на Манхэттене (`Manhattan`)."<br>Предложения для путешествия (`Travel Suggestions`): |
| **Output**      | 1.  **Узрите `Empire State of Mind`:** Взберитесь на головокружительные высоты `Empire State Building` и понежьтесь в славе манхэттенского скайлайна (`Manhattan's skyline`). Приготовьтесь почувствовать себя Кинг-Конгом (`King Kong`) на вершине Большого Яблока (`Big Apple`), только без гигантского банана размером с обезьяну.<br>2.  **Займитесь `Artsy-Fartsy` в `MoMA`:** Дайте волю своему внутреннему арт-афисионадо (`art aficionado`) в Музее Современного Искусства (`Museum of Modern Art`, `MoMA`). Полюбуйтесь шедеврами, которые поразят ваше воображение и заставят задуматься, имеют ли ваши рисунки человечков-палочек (`stick-figure drawings`) хоть какую-то художественную ценность (`artistic merit`).<br>3.  **Шопинг "Пока не упадешь" на Пятой Авеню (`Shop 'Til You Drop on Fifth Avenue`):** Побалуйте себя небольшой розничной терапией (`retail therapy`) на знаменитой Пятой Авеню (`Fifth Avenue`). Приготовьтесь к шоку от цен (`sticker shock`), пока вы глазеете на витрины (или действительно покупаете) в дизайнерских бутиках (`designer boutiques`), которые заставят ваш кошелек плакать. Но эй, вы же на Манхэттене (`Manhattan`), так что можно и принять эту сказочность (`fabulousness`)! |

**Таблица 6.** Пример ролевого `промптинга` с юмористическим тоном и стилем

---

### Контекстуальный промптинг (`Contextual prompting`)

Предоставляя контекстуальные `промпты` (`contextual prompts`), вы можете помочь гарантировать, что ваши взаимодействия с ИИ (`AI interactions`) будут максимально бесшовными (`seamless`) и эффективными (`efficient`). Модель (`model`) сможет быстрее понять ваш запрос (`request`) и генерировать более точные и релевантные ответы (`accurate and relevant responses`), как вы можете видеть в примере Таблицы 7.
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| :-------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Goal**        | Предложить статьи для блога (`blog`) о ретро (`retro`) играх.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Temperature** | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Top-K**       | 40                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Top-P**       | 0.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Prompt**      | **Контекст (`Context`):** Вы пишете для блога (`blog`) о ретро (`retro`) аркадных видеоиграх 80-х (`80's arcade video games`).<br>Предложите 3 темы (`topics`) для написания статьи (`article`) с несколькими строками описания (`description`) того, что эта статья должна содержать.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Output**      | 1.  **\*\*Эволюция дизайна аркадных автоматов (`The Evolution of Arcade Cabinet Design`)\*\***<br>    - Эта статья исследовала бы эволюцию дизайна аркадных автоматов (`arcade cabinet designs`), от ранних деревянных и металлических автоматов 1970-х до гладких, освещенных неоном (`neon-lit`) дизайнов 1980-х и далее.<br>2.  **\*\*Взрыв из прошлого: Культовые аркадные игры 80-х (`Blast From The Past: Iconic Arcade Games of The 80's`)\*\***<br>    - Эта статья представила бы взгляд на историю, влияние и наследие (`history, impact, and legacy`) некоторых из самых культовых (`iconic`) и влиятельных (`influential`) аркадных игр (`arcade games`) 1980-х, подчеркивая их инновации (`innovations`), популярную механику (`popular mechanics`) и непреходящее очарование (`enduring charm`).<br>3.  **\*\*Подъем и ретро-возрождение пиксель-арта (`The Rise and Retro Revival of Pixel Art`)\*\***<br>    - Эта статья углубилась бы в эволюцию пиксель-арта (`pixel art`) как определяющего визуального стиля (`visual style`) ранних аркадных игр (`early arcade games`), прослеживая его корни (`roots`), исследуя его техники (`techniques`) и обсуждая возрождение (`resurgence`) пиксель-арта в современных играх (`modern games`) и цифровом искусстве (`digital art`). |

**Таблица 7.** Пример контекстуального `промптинга` (`contextual prompting`)
### Step-back prompting

`Step-back`⁸ `промптинг` — это техника для улучшения производительности (`performance`) путем `промптинга` `LLM`, чтобы сначала рассмотреть общий вопрос (`general question`), связанный с конкретной задачей (`specific task`), а затем передать (`feeding`) ответ на этот общий вопрос в последующий `промпт` для конкретной задачи. Этот "шаг назад" (`step back`) позволяет `LLM` активировать релевантные фоновые знания (`relevant background knowledge`) и процессы рассуждения (`reasoning processes`) перед попыткой решить конкретную проблему (`specific problem`).

Рассматривая более широкие и основополагающие принципы (`broader and underlying principles`), `LLM` могут генерировать более точные и проницательные ответы (`accurate and insightful responses`). `Step-back промптинг` побуждает `LLM` мыслить критически (`think critically`) и применять свои знания новыми и творческими способами (`new and creative ways`). Он изменяет финальный `промпт`, выполняющий задачу, используя больше знаний из параметров (`parameters`) `LLM`, чем было бы задействовано в противном случае, когда `LLM` `промптуется` напрямую.

Он может помочь смягчить предвзятости (`mitigate biases`) в ответах `LLM`, фокусируясь на общих принципах (`general principles`) вместо специфических деталей (`specific details`) — `step-back промптинг`.

Давайте взглянем на эти примеры, чтобы понять, как `step-back промптинг` может улучшить результаты. Сначала рассмотрим традиционный `промпт` (Таблица 8), прежде чем сравнить его со `step-back промптом` (Таблица 9):
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| :-------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Goal**        | Написать сюжетную линию (`storyline`) для уровня видеоигры - шутера от первого лица (`first-person shooter`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Temperature** | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Top-K**       | 40                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Top-P**       | 0.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Prompt**      | Напишите сюжетную линию (`storyline`) в один абзац для нового уровня видеоигры - шутера от первого лица (`first-person shooter`), который будет сложным (`challenging`) и увлекательным (`engaging`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Output**      | Уровень начинается с того, что отряд игрока (`player's squad`) попадает в засаду (`ambushed`) в плотной городской застройке (`dense urban area`) безжалостной вражеской фракцией (`relentless enemy faction`). Игроки должны пробиваться сквозь лабиринт (`maze`) переулков (`back alleys`) и полуразрушенных зданий (`dilapidated buildings`), используя скрытность (`stealth`) и точность (`precision`) для уничтожения вражеских сил (`enemy forces`) и избежания обнаружения (`avoid detection`). Игрок должен использовать свое окружение (`environment`) в своих интересах, устанавливая ловушки (`setting traps`), используя укрытия (`utilizing cover`) и совершая просчитанные ходы (`calculated moves`) для выживания (`survive`). По пути они находят разведданные (`intel`), предполагающие, что враг планирует разрушительную атаку (`devastating attack`), и игрок должен мчаться наперегонки со временем (`race against time`), чтобы собрать доказательства (`gather evidence`) и передать их обратно в свой штаб (`headquarters`), прежде чем враг сможет осуществить свои планы. |

**Таблица 8.** Традиционный `промпт` перед сравнением со `step-back промптом`

Когда вы устанавливаете `температуру` (`temperature`) на 1, вы можете получить всевозможные творческие варианты (`creative writings`) для сюжетной линии (`storyline`), но они также будут довольно случайными (`random`) и общими (`generic`). Так что давайте сделаем шаг назад (`step back`):
|            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :--------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt** | Основываясь на популярных экшн-играх (`action games`) - шутерах от первого лица (`first-person shooter`), каковы 5 вымышленных ключевых сеттингов (`fictional key settings`), которые способствуют созданию сложной (`challenging`) и увлекательной (`engaging`) сюжетной линии (`level storyline`) уровня в видеоигре - шутере от первого лица?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Output** | 1.  **\*\*Заброшенная военная база (`Abandoned Military Base`)\*\***: Обширный, постапокалиптический (`post-apocalyptic`) военный комплекс (`military complex`), кишащий мутировавшими солдатами (`mutated soldiers`) и взбунтовавшимися роботами (`rogue robots`), идеален для сложного огневого боя (`challenging firearm combat`).<br>2.  **\*\*Киберпанк-город (`Cyberpunk City`)\*\***: Освещенная неоном (`neon-lit`), футуристическая (`futuristic`) городская среда (`urban environment`) с возвышающимися небоскребами (`towering skyscrapers`) и густыми переулками (`dense alleyways`), с кибернетически улучшенными врагами (`cybernetically enhanced enemies`) и механикой взлома (`hacking mechanics`).<br>3.  **\*\*Космический корабль пришельцев (`Alien Spaceship`)\*\***: Огромный корабль пришельцев (`alien vessel`), потерпевший крушение на Земле, с жуткими коридорами (`eerie corridors`), секциями с невесомостью (`zero-gravity sections`) и внеземными существами (`extraterrestrial creatures`), с которыми предстоит столкнуться.<br>4.  **\*\*Город, зараженный зомби (`Zombie-Infested Town`)\*\***: Заброшенный город (`desolate town`), захваченный ордами агрессивных зомби (`hordes of aggressive zombies`), с интенсивными боями на ближней дистанции (`intense close-quarters combat`) и решением головоломок (`puzzle-solving`) для поиска безопасного прохода (`safe passage`).<br>5.  **\*\*Подводный исследовательский комплекс (`Underwater Research Facility`)\*\***: Глубоководная лаборатория (`deep-sea laboratory`), затопленная водой, наполненная мутировавшими водными существами (`mutated aquatic creatures`) и требующая навыков скрытности (`stealth`) и подводного исследования (`underwater exploration`) для выживания (`survive`). |

**Таблица 9.** Пример `промптинга` для самосогласованности (`self consistency`) *(Примечание: на предыдущей странице эта таблица упоминалась как пример step-back промпта)*

Да, эти темы кажутся подходящими для видеоигры от первого лица. Давайте вернемся к оригинальному `промпту`, но на этот раз включим ответ из "шага назад" (`step back`) в качестве контекста (`context`) и посмотрим, что он вернет.
|            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :--------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt** | **Контекст (`Context`):** 5 увлекательных тем (`engaging themes`) для видеоигры - шутера от первого лица (`first person shooter`):<br>1. **\*\*Заброшенная военная база (`Abandoned Military Base`)\*\***: Обширный, постапокалиптический (`post-apocalyptic`) военный комплекс (`military complex`), кишащий мутировавшими солдатами (`mutated soldiers`) и взбунтовавшимися роботами (`rogue robots`), идеален для сложного огневого боя (`challenging firearm combat`).<br>2. **\*\*Киберпанк-город (`Cyberpunk City`)\*\***: Освещенная неоном (`neon-lit`), футуристическая (`futuristic`) городская среда (`urban environment`) с возвышающимися небоскребами (`towering skyscrapers`) и густыми переулками (`dense alleyways`), с кибернетически улучшенными врагами (`cybernetically enhanced enemies`) и механикой взлома (`hacking mechanics`).<br>3. **\*\*Космический корабль пришельцев (`Alien Spaceship`)\*\***: Огромный корабль пришельцев (`alien vessel`), потерпевший крушение на Земле, с жуткими коридорами (`eerie corridors`), секциями с невесомостью (`zero-gravity sections`) и внеземными существами (`extraterrestrial creatures`), с которыми предстоит столкнуться.<br>4. **\*\*Город, зараженный зомби (`Zombie-Infested Town`)\*\***: Заброшенный город (`desolate town`), захваченный ордами агрессивных зомби (`hordes of aggressive zombies`), с интенсивными боями на ближней дистанции (`intense close-quarters combat`) и решением головоломок (`puzzle-solving`) для поиска безопасного прохода (`safe passage`).<br>5. **\*\*Подводный исследовательский комплекс (`Underwater Research Facility`)\*\***: Глубоководная лаборатория (`deep-sea laboratory`), затопленная водой, наполненная мутировавшими водными существами (`mutated aquatic creatures`) и требующая навыков скрытности (`stealth`) и подводного исследования (`underwater exploration`) для выживания (`survive`).<br><br>Возьмите одну из тем и напишите сюжетную линию (`storyline`) в один абзац для нового уровня видеоигры - шутера от первого лица (`first-person shooter`), который будет сложным (`challenging`) и увлекательным (`engaging`). |
| **Output** | В сердце мутной бездны (`murky abyss`) лежит полуразрушенный подводный исследовательский комплекс (`underwater research facility`), стоящий как свидетельство человеческих амбиций и их катастрофических последствий. Погруженный во тьму, пульсирующий гулом неисправной техники (`malfunctioning machinery`) и преследуемый эхом утонувших душ, комплекс теперь является питательной средой для кошмара, рожденного из глубокого моря. Игрок, элитный морпех (`elite marine`), оснащенный передовым водолазным снаряжением (`advanced diving gear`) и экспериментальным оружием (`experimental weaponry`), получает задание проникнуть в это водное царство террора (`aquatic realm of terror`). Вооруженный стойкостью (`resilience`) и находчивостью (`resourcefulness`), он должен перемещаться по коварным коридорам (`treacherous corridors`), решать загадочные головоломки (`cryptic puzzles`) и противостоять ужасным морским чудовищам (`gruesome sea monstrosities`), скрывающимся в глубинах. Борясь с сокрушительным давлением (`crushing pressure`) глубокого моря, чтобы перехитрить коварных водных хищников (`cunning aquatic predators`), каждое мгновение в этом неизведанном подводном мире (`uncharted underworld`) испытывает пределы человеческой выносливости (`human endurance`) и мужества (`courage`). |

**Таблица 10.** Пример `промптинга` для самосогласованности (`self consistency`)

Это похоже на интересную видеоигру! Используя техники `step-back промптинга`, вы можете повысить точность (`accuracy`) ваших `промптов`.
### Цепочка Мышления (`Chain of Thought`, CoT)

`Chain of Thought (CoT)`⁹ `промптинг` — это техника для улучшения способностей `LLM` к рассуждению (`reasoning capabilities`) путем генерации **промежуточных шагов рассуждения** (`intermediate reasoning steps`). Это помогает `LLM` генерировать более точные ответы. Вы можете комбинировать его с `few-shot промптингом`, чтобы получить лучшие результаты на более сложных задачах (`complex tasks`), требующих рассуждения перед ответом, так как это является проблемой для `zero-shot chain of thought`.

`CoT` имеет много преимуществ. Во-первых, он требует мало усилий (`low-effort`), при этом очень эффективен и хорошо работает с готовыми `LLM` (`off-the-shelf LLMs`) (поэтому нет необходимости в `finetune`). Вы также получаете интерпретируемость (`interpretability`) с `CoT промптингом`, так как можете учиться на ответах `LLM` и видеть шаги рассуждения (`reasoning steps`), которым она следовала. Если есть сбой (`malfunction`), вы сможете его идентифицировать. `Chain of thought`, по-видимому, улучшает робастность (`robustness`) при переходе между разными версиями `LLM`. Это означает, что производительность (`performance`) вашего `промпта` должна меньше изменяться (`drift less`) между разными `LLM`, чем если бы ваш `промпт` не использовал цепочки рассуждений (`reasoning chains`). Конечно, есть и недостатки, но они довольно интуитивны.

Ответ `LLM` включает рассуждения `chain of thought`, что означает больше выходных `токенов` (`output tokens`), а это значит, что предсказания (`predictions`) стоят дороже (`cost more money`) и занимают больше времени (`take longer`).

Чтобы объяснить следующий пример в Таблице 11, давайте сначала попробуем создать `промпт`, который не использует `CoT промптинг`, чтобы продемонстрировать недостатки (`flaws`) большой языковой модели (`large language model`).

|            |                                                                                                                                                                         |
| :--------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt** | Когда мне было 3 года, мой партнер был в 3 раза старше меня. Сейчас мне 20 лет. Сколько лет моему партнеру? (`When I was 3 years old, my partner was 3 times my age. Now, I am 20 years old. How old is my partner?`) |
| **Output** | 63 года (`63 years old`)                                                                                                                                                 |

**Таблица 11.** Пример `промпта`, который пытается решить математическую задачу Ужас (`Yikes`). Это очевидно неправильный ответ. На самом деле, `LLM` часто испытывают трудности с математическими задачами (`mathematical tasks`) и могут давать неверные ответы — даже для такой простой задачи, как умножение двух чисел. Это связано с тем, что они обучены на больших объемах текста и математики (`large volumes of text and math`) и могут требовать другого подхода. Так что давайте посмотрим, улучшат ли вывод промежуточные шаги рассуждения (`intermediate reasoning steps`).

|            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :--------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt** | Когда мне было 3 года, мой партнер был в 3 раза старше меня. Сейчас мне 20 лет. Сколько лет моему партнеру? Давай подумаем шаг за шагом. (`When I was 3 years old, my partner was 3 times my age. Now, I am 20 years old. How old is my partner? Let's think step by step.`)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Output** | 1.  Предположим, мой текущий возраст - "x" лет. (`Let's assume my current age is "x" years.`)<br>2.  Когда мне было 3 года, мой возраст был 3 года. (`When I was 3 years old, my age was 3 years.`)\<br>3.  Возраст моего партнера в то время был в 3 раза больше моего возраста, что означает, что возраст моего партнера был 3 * 3 = 9 лет. (`My partner's age at that time was 3 times my age, which means my partner's age was 3 * 3 = 9 years.`)\<br>4.  Сейчас мне 20 лет, что означает, что мой возраст увеличился на 20 - 3 = 17 лет с тех пор, как мне было 3 года. (`Now, I am 20 years old, which means my age has increased by 20 - 3 = 17 years since I was 3 years old.`)\<br>5.  Поскольку возраст моего партнера был 9 лет, когда мне было 3 года, и мой возраст увеличился на 17 лет, возраст моего партнера также должен был увеличиться на 17 лет. (`Since my partner's age was 9 years when I was 3 years old, and my age has increased by 17 years, my partner's age must have also increased by 17 years.`)\<br>6.  Следовательно, текущий возраст моего партнера составляет 9 + 17 = 26 лет. (`Therefore, my partner's current age is 9 + 17 = 26 years.`)\<br><br>Итак, моему партнеру 26 лет. (`So, my partner is 26 years old.`) |

**Таблица 12.** Пример `Chain of Thought промптинга` (`Chain of Thought prompting`)

Хорошо, теперь окончательный ответ верный. Это потому, что мы четко проинструктировали (`instructed`) `LLM` объяснить каждый шаг, вместо того чтобы просто вернуть ответ. Интересно видеть, что модель складывает 17 прошедших лет. В уме я бы взял разницу в годах между моим партнером и мной и добавил бы ее к 20. (`20+(9-3)`). Давайте поможем модели думать немного больше похоже на меня.
Таблица 12 — это пример `zero-shot` `Chain of thought`. `Chain of thought промптинг` может быть очень мощным в сочетании с `single-shot` или `few-shot`, как вы можете видеть в Таблице 13:

|            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| :--------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt** | **Q:** Когда моему брату было 2 года, я был вдвое старше его. Сейчас мне 40 лет. Сколько лет моему брату? Давай подумаем шаг за шагом.<br>**A:** Когда моему брату было 2 года, мне было 2 * 2 = 4 года. Это разница в возрасте 2 года, и я старше. Сейчас мне 40 лет, значит моему брату 40 - 2 = 38 лет. Ответ 38.<br><br>**Q:** Когда мне было 3 года, мой партнер был в 3 раза старше меня. Сейчас мне 20 лет. Сколько лет моему партнеру? Давай подумаем шаг за шагом.<br>**A:** |
| **Output** | Когда мне было 3 года, моему партнеру было 3 * 3 = 9 лет. Это разница в возрасте 6 лет, и мой партнер старше. Сейчас мне 20 лет, значит моему партнеру 20 + 6 = 26 лет. Ответ 26.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

**Таблица 13.** Пример `chain of thought промптинга` с `single-shot`

`Chain of thought` может быть полезен для различных сценариев использования (`use-cases`). Подумайте о генерации кода (`code generation`), разбиении запроса (`request`) на несколько шагов и сопоставлении (`mapping`) их с конкретными строками кода. Или для создания синтетических данных (`synthetic data`), когда у вас есть некое начальное значение (`seed`), например, *"Продукт называется XYZ, напишите описание, направляющее модель через предположения (`assumptions`), которые вы сделали бы на основе данного названия продукта."* В целом, любая задача, которую можно решить путем "проговаривания" (`talking through`), является хорошим кандидатом для `chain of thought`. Если вы можете объяснить шаги для решения проблемы, попробуйте `chain of thought`.

Пожалуйста, обратитесь к `notebook`¹⁰, размещенному в `репозитории GoogleCloudPlatform Github`, который более подробно рассмотрит `CoT промптинг`: В разделе лучших практик (`best practices`) этой главы мы изучим некоторые лучшие практики, специфичные для `Chain of thought промптинга`.

---

### Самосогласованность (`Self-consistency`)

Хотя большие языковые модели (`large language models`) показали впечатляющие успехи в различных задачах `NLP` (`NLP tasks`), их способность к рассуждению (`ability to reason`) часто рассматривается как ограничение, которое не может быть преодолено исключительно увеличением размера модели (`model size`). Как мы узнали в предыдущем разделе о `Chain of Thought промптинге`, модель можно `запромптить` (`prompted`) генерировать шаги рассуждения (`reasoning steps`), подобно тому, как человек решает проблему. Однако `CoT` использует простую стратегию "жадного декодирования" (`greedy decoding`), ограничивая свою эффективность. "**Самосогласованность**" (`Self-consistency`)¹¹ комбинирует `сэмплинг` (`sampling`) и голосование по большинству (`majority voting`) для генерации разнообразных путей рассуждения (`diverse reasoning paths`) и выбора наиболее последовательного ответа. Это улучшает точность (`accuracy`) и согласованность (`coherence`) ответов, генерируемых `LLM`.

`Самосогласованность` дает псевдовероятностную (`pseudo-probability`) оценку правильности ответа, но, очевидно, сопряжена с высокими затратами (`high costs`).

Она следует следующим шагам:

1.  **Генерация разнообразных путей рассуждения (`reasoning paths`):** `LLM` предоставляется один и тот же `промпт` несколько раз. Высокое значение `температуры` (`temperature setting`) побуждает модель генерировать различные пути рассуждения и взгляды (`perspectives`) на проблему.
2.  **Извлечение ответа из каждого сгенерированного ответа.**
3.  **Выбор наиболее часто встречающегося ответа.**

Давайте рассмотрим пример системы классификации электронной почты (`email classification system`), которая классифицирует письмо как **ВАЖНОЕ (`IMPORTANT`)** или **НЕ ВАЖНОЕ (`NOT IMPORTANT`)**. `Zero-shot chain of thought промпт` будет отправлен `LLM` несколько раз, чтобы увидеть, отличаются ли ответы после каждой отправки. Обратите внимание на дружелюбный тон (`friendly tone`), выбор слов (`word choice`) и сарказм (`sarcasm`), использованные в письме. Все это может обмануть (`trick`) `LLM`.
|                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Prompt**           | **EMAIL:**<br>...<br>Привет,<br><br>Я видел, вы используете `Wordpress` для вашего веб-сайта. Отличная `open source` система управления контентом (`content management system`). Я тоже использовал ее в прошлом. Она поставляется с множеством отличных пользовательских плагинов (`user plugins`). И ее довольно легко настроить.<br><br>Я заметил `баг` (`bug`) в контактной форме (`contact form`), который возникает, когда вы выбираете поле имени (`name field`). Смотрите прикрепленный скриншот (`screenshot`), где я ввожу текст в поле имени. Обратите внимание на всплывающее окно `JavaScript` (`JavaScript alert box`), которое я вызвал (`invoked`).<br><br>Но в остальном это отличный веб-сайт. Мне нравится его читать. Не стесняйтесь оставить `баг` на веб-сайте, потому что это дает мне больше интересных вещей для чтения.<br><br>Удачи,<br>Гарри Хакер (`Harry the Hacker`).<br>...<br><br>Классифицируйте приведенное выше письмо как **ВАЖНОЕ (`IMPORTANT`)** или **НЕ ВАЖНОЕ (`NOT IMPORTANT`)**. Давайте подумаем шаг за шагом и объясним почему. |
| **Output Attempt 1** | **\*\*Шаг 1: Определите цель письма.\*\***<br>Цель письма — проинформировать получателя о `баге` в контактной форме на их веб-сайте. Отправитель также упоминает, что ему нравится читать веб-сайт, и что он пока оставляет `баг` на месте.<br><br>**\*\*Шаг 2: Оцените потенциальное влияние `бага`.\*\***<br>`Баг` в контактной форме может позволить злоумышленнику (`attacker`) выполнить произвольный `JavaScript` код на веб-сайте. Это может привести к тому, что злоумышленник сможет получить контроль над веб-сайтом (`take control of the website`), украсть конфиденциальную информацию (`steal sensitive information`) или испортить (`deface`) веб-сайт.<br><br>**\*\*Шаг 3: Рассмотрите достоверность (`credibility`) отправителя.\*\***<br>Отправитель письма утверждает, что он `хакер` (`hacker`) по имени Гарри. Однако нет способа проверить личность отправителя. Возможно, что отправитель — это легитимный `хакер`, который пытается помочь получателю, но также возможно, что отправитель — это злоумышленник (`malicious actor`), который пытается обмануть получателя, чтобы тот кликнул по вредоносной ссылке (`malicious link`) или скачал вредоносный файл (`malicious file`).<br><br>**\*\*Заключение: ВАЖНО (`IMPORTANT`)\*\***<br>Основываясь на потенциальном влиянии `бага` и достоверности отправителя, письмо следует классифицировать как **\*\*ВАЖНОЕ (`IMPORTANT`)\*\***. Получателю следует немедленно принять меры для исправления `бага` и защиты своего веб-сайта от атаки. |
| **Output Attempt 2** | **\*\*Объяснение:\*\***<br>1.  **\*\*Отсутствие срочности (`Lack of urgency`):\*\*** Письмо не передает никакого чувства срочности или временной чувствительности. Оно начинается с непринужденного приветствия и представляет информацию в констатирующем (`matter-of-fact`) тоне.<br>2.  **\*\*Отчет о некритическом `баге` (`Non-critical bug report`):\*\*** Сообщенный `баг` в контактной форме описывается как интересный, но не критический. Письмо даже предполагает, что владелец веб-сайта может оставить `баг` на месте.<br>3.  **\*\*Отсутствие личного влияния (`Lack of personal impact`):\*\*** Письмо не указывает на какое-либо прямое или личное влияние на владельца веб-сайта. Оно просто упоминает, что отправителю нравится читать веб-сайт.<br>4.  **\*\*Отсутствие запроса на действие (`Absence of action request`):\*\*** Письмо явно не запрашивает никаких действий от владельца веб-сайта. Оно не просит исправить `баг` или предоставить какие-либо конкретные предложения по улучшению.<br>5.  **\*\*Намерение отправителя (`Sender's intent`):\*\*** Намерение отправителя, похоже, больше сосредоточено на том, чтобы поделиться наблюдением и выразить интерес к веб-сайту, а не на том, чтобы поднять серьезную проблему (`serious concern`) или запросить помощь (`requesting assistance`).<br><br>**\*\*Заключение: НЕ ВАЖНО (`NOT IMPORTANT`)\*\*** |
| **Output Attempt 3** | **\*\*Шаг 1: Определите цель письма.\*\***<br>Цель письма — проинформировать получателя о `баге` в контактной форме на их веб-сайте. Отправитель также упоминает, что ему нравится читать веб-сайт, и что он пока оставляет `баг` на месте.<br><br>**\*\*Шаг 2: Оцените потенциальное влияние `бага`.\*\***<br>`Баг` в контактной форме может позволить злоумышленнику (`attacker`) выполнить произвольный `JavaScript` код на веб-сайте. Это может привести к тому, что злоумышленник сможет получить контроль над веб-сайтом (`take control of the website`), украсть конфиденциальную информацию (`steal sensitive information`) или испортить (`deface`) веб-сайт.<br><br>**\*\*Шаг 3: Рассмотрите достоверность (`credibility`) отправителя.\*\***<br>Отправитель письма утверждает, что он `хакер` (`hacker`) по имени Гарри. Однако нет способа проверить личность отправителя. Возможно, что отправитель — это легитимный `хакер`, который пытается помочь получателю, но также возможно, что отправитель — это злоумышленник (`malicious actor`), который пытается эксплуатировать (`exploit`) `баг` для своей выгоды (`own gain`).<br><br>**\*\*Заключение:\*\***<br>Основываясь на вышеуказанных факторах, письмо следует классифицировать как **\*\*ВАЖНОЕ (`IMPORTANT`)\*\***. `Баг` в контактной форме представляет собой серьезный риск безопасности (`serious security risk`), а достоверность отправителя неизвестна. Получателю следует немедленно принять меры для исправления `бага` и [...пропущено в оригинале...] |

**Таблица 14.** Пример `промптинга` для самосогласованности (`self consistency`)

---

Вы можете использовать приведенный выше `промпт` и попробовать посмотреть, вернет ли он последовательную классификацию. В зависимости от используемой модели и конфигурации `температуры`, он может вернуть **"ВАЖНОЕ" (`IMPORTANT`)** или **"НЕ ВАЖНОЕ" (`NOT IMPORTANT`)**.
Генерируя множество Цепочек Мышления (`Chains of Thoughts`) и выбирая наиболее часто встречающийся ответ ("**ВАЖНОЕ**" - `IMPORTANT`), мы можем получить более последовательно правильный ответ от `LLM`.

Этот пример показывает, как `промптинг` самосогласованности (`self-consistency prompting`) может быть использован для повышения точности (`accuracy`) ответа `LLM` путем рассмотрения множества перспектив (`multiple perspectives`) и выбора наиболее последовательного ответа.

---

### Дерево Мышления (`Tree of Thoughts`, ToT)

Теперь, когда мы знакомы с `промптингом` цепочки мышления (`chain of thought`) и самосогласованности (`self-consistency prompting`), давайте рассмотрим Дерево Мышления (`Tree of Thoughts`, `ToT`)¹². Оно обобщает концепцию `CoT промптинга`, поскольку позволяет `LLM` исследовать (`explore`) множество различных путей рассуждения (`reasoning paths`) одновременно, а не просто следовать одной линейной цепочке мышления (`linear chain of thought`). Это изображено на Рисунке 1.

![image](https://github.com/user-attachments/assets/bf893032-3488-4f8f-81e2-b8ef0fbec7c6)

**Рисунок 1.** Визуализация `chain of thought промптинга` слева в сравнении с `Tree of Thoughts промптингом` справа.
Этот подход делает `ToT` особенно хорошо подходящим для сложных задач (`complex tasks`), требующих исследования (`exploration`). Он работает путем поддержания дерева мыслей (`tree of thoughts`), где каждая мысль (`thought`) представляет собой последовательную языковую последовательность (`coherent language sequence`), служащую промежуточным шагом (`intermediate step`) к решению проблемы. Затем модель может исследовать различные пути рассуждения (`reasoning paths`), ответвляясь (`branching out`) от разных узлов (`nodes`) в дереве.

Есть отличный `notebook`, который немного подробнее раскрывает Дерево Мышления (`Tree of Thought`, `ToT`), основанный на статье "`Large Language Model Guided Tree-of-Thought`".*

---

### ReAct (reason & act - рассуждай и действуй)

`Reason and act (ReAct)` [10]¹³ `промптинг` — это парадигма (`paradigm`), позволяющая `LLM` решать сложные задачи (`complex tasks`), используя рассуждение на естественном языке (`natural language reasoning`) в сочетании с внешними инструментами (`external tools`) (поиск (`search`), интерпретатор кода (`code interpreter`) и т.д.), позволяя `LLM` выполнять определенные действия (`perform certain actions`), такие как взаимодействие с внешними `API` (`external APIs`) для получения информации (`retrieve information`), что является первым шагом к моделированию агентов (`agent modeling`).

`ReAct` имитирует (`mimics`), как люди действуют в реальном мире, поскольку мы рассуждаем вербально и можем предпринимать действия для получения информации. `ReAct` хорошо работает по сравнению с другими подходами `prompt engineering` в различных областях (`domains`).

`ReAct промптинг` работает путем объединения рассуждения (`reasoning`) и действия (`acting`) в цикл мысль-действие (`thought-action loop`). `LLM` сначала рассуждает о проблеме и генерирует план действий (`plan of action`). Затем она выполняет действия (`actions`) по плану и наблюдает за результатами (`observes the results`). Затем `LLM` использует наблюдения для обновления своих рассуждений и генерации нового плана действий. Этот процесс продолжается до тех пор, пока `LLM` не достигнет решения проблемы (`reaches a solution`).

Чтобы увидеть это в действии, вам нужно написать немного кода. В `Сниппете кода 1` (`code Snippet 1`) я использую фреймворк `langchain` для `Python`, вместе с `VertexAI` (`google-cloud-aiplatform`) и `pip` пакетами `google-search-results`.
Чтобы запустить этот пример (`sample`), вы должны создать (бесплатный) ключ `SerpAPI` (`SerpAPI key`) с [https://serpapi.com/manage-api-key](https://serpapi.com/manage-api-key) и установить переменную окружения (`environment variable`) `SERPAPI_API_KEY`.

Далее давайте напишем немного кода на `Python`, с задачей для `LLM` выяснить: *Сколько детей у участников группы Metallica, у которых есть знаменитый отец, выступающий в этой группе?*

```python
from langchain.agents import load_tools
from langchain.agents import initialize_agent
from langchain.agents import AgentType
from langchain.llms import VertexAI

prompt = "How many kids do the band members of Metallica have?"

llm = VertexAI(temperature=0.1)
tools = load_tools(["serpapi"], llm=llm)

agent = initialize_agent(tools, llm,
agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=True)
agent.run(prompt)
```
Сниппет 1. Создание ReAct Агента (ReAct Agent) с LangChain и VertexAI

Сниппет кода 2 (`Code Snippet 2`) показывает результат. Заметьте, что ReAct выполняет цепочку из пяти поисков (`chain of five searches`). Фактически, LLM парсит (`scraping`) результаты поиска Google (`Google search results`), чтобы выяснить имена участников группы (`band names`). Затем она перечисляет результаты как наблюдения (`observations`) и строит цепочку мысли (`chains the thought`) для следующего поиска.
```text
> Entering new AgentExecutor chain...
Metallica has 4 members.
Action: Search
Action Input: How many kids does James Hetfield have?
Observation: three children
Thought: 1/4 Metallica band members have 3 children
Action: Search
Action Input: How many kids does Lars Ulrich have?
Observation: 3
Thought: 2/4 Metallica band members have 6 children
Action: Search
Action Input: How many kids does Kirk Hammett have?
Observation: Hammett has been married to his second wife Lani since 1998. They have two sons, Angel (b. September 29, 2006) and Vincenzo (b. June 28, 2008).
Thought: 3/4 Metallica band members have 8 children
Action: Search
Action Input: How many kids does Robert Trujillo have?
Observation: 2
Thought: 4/4 Metallica band members have 10 children
Final Answer: 10
```

Сниппет 2. Выполнение ReAct Агента (ReAct Agent) в терминале

Сниппет кода 2 (`Code Snippet 2`) выясняет, что в группе Metallica четыре участника. Затем он ищет информацию по каждому участнику группы (`band member`), чтобы запросить общее количество детей и суммировать итог. Наконец, он возвращает общее количество детей в качестве окончательного ответа (`final answer`).
ReAct промптинг на практике требует понимания того, что вам постоянно нужно повторно отправлять предыдущие промпты/ответы (`prompts/responses`) (и выполнять обрезку (`trimming`) лишнего сгенерированного контента (`extra generated content)`), а также настраивать модель с помощью подходящих примеров/инструкций (`appropriate examples/instructions`). Пожалуйста, обратитесь к notebook¹⁴, размещенному в репозитории GoogleCloudPlatform Github, который немного подробнее покажет фактические вводы и выводы LLM (`actual LLM inputs and outputs`) с более сложным примером.
---

### Автоматический Промпт Инжиниринг (`Automatic Prompt Engineering`)

К этому моменту вы могли осознать, что написание `промпта` (`prompt`) может быть сложным. Не было бы здорово автоматизировать это (написать `промпт`, чтобы писать `промпты`)? Что ж, есть метод: `Automatic Prompt Engineering` (`APE`). Этот метод¹⁵ не только уменьшает потребность в человеческом вводе (`human input`), но и повышает производительность (`performance`) модели в различных задачах.

Вы `запромптите` (`prompt`) модель для генерации большего количества `промптов`. Оцените их, возможно, измените хорошие. И повторите.

Например, вы можете использовать автоматический `промпт инжиниринг` для помощи в обучении чат-бота (`chatbot`) для интернет-магазина футболок с мерчем. Мы хотим выяснить все различные способы, которыми клиенты могли бы сформулировать свой заказ на покупку футболки с мерчем группы.

1.  Напишите `промпт`, который будет генерировать варианты вывода (`output variants`). В этом примере я использую `gemini-pro` для генерации 10 инструкций. См. Таблицу 15:

|            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| :--------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt** | У нас есть интернет-магазин футболок с мерчем группы (`band merchandise t-shirt webshop`), и для обучения `чат-бота` (`chatbot`) нам нужны различные способы заказа: "Одна футболка `Metallica` размер S". Сгенерируйте 10 вариантов (`variants`), с той же семантикой (`semantics`), но сохраняя тот же смысл (`meaning`).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Output** | 1.  I'd like to purchase a Metallica t-shirt in size small.<br>2.  Can I order a small-sized Metallica t-shirt?<br>3.  I'd like to buy one Metallica t-shirt in small.<br>4.  One Metallica shirt, size small, please.<br>5.  I want one Metallica t-shirt in size small.<br>6.  I'd like to place an order for one Metallica t-shirt in small.<br>7.  Small Metallica t-shirt, one please.<br>8.  I'm looking for one Metallica t-shirt in small.<br>9.  Can you get me one Metallica t-shirt in small?<br>10. One Metallica small t-shirt, please.                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

**Таблица 15.** Использование `LLM` для генерации `промптов`

2.  Оцените всех кандидатов в инструкции (`instruction candidates`), выставив им оценки (`scoring`) на основе выбранной метрики (`metric`). Например, вы можете использовать `BLEU` (`Bilingual Evaluation Understudy`) или `ROUGE` (`Recall-Oriented Understudy for Gisting Evaluation`).
3.  Выберите кандидата в инструкцию с наивысшей оценкой (`highest evaluation score`). Этот кандидат будет окончательным `промптом` (`final prompt`), который вы можете использовать в своем программном приложении (`software application`) или `чат-боте` (`chatbot`). Вы также можете подправить (`tweak`) выбранный `промпт` и снова оценить.
### Code prompting (Промптинг для кода)

`Gemini` фокусируется в первую очередь на текстовых `промптах` (`text-based prompts`), что также включает написание `промптов` для возврата кода (`code`). Давайте перейдем в `Vertex AI Studio` и протестируем эти `промпты`, чтобы посмотреть на некоторые примеры кодирования (`coding examples`).

#### Промпты для написания кода (`Prompts for writing code`)

`Gemini` также может быть разработчиком (`developer`) и помочь вам с написанием кода (`writing code`) на любом выбранном вами языке программирования (`programming language`). Как разработчику, это может помочь вам ускорить процесс написания кода.

Представьте папку на вашей машине с сотнями файлов, которые нужно переименовать. Переименование каждого файла займет у вас много времени. Вы немного знаете `Bash` и могли бы написать `скрипт` (`script`) для автоматизации этого, но это тоже может занять некоторое время. Так что давайте напишем `промпт`. Вы можете написать `промпт` в публичном потребительском `чат-боте Gemini` (`public consumer chatbot Gemini`), или, если вы больше обеспокоены конфиденциальностью (`confidentiality`), вы можете написать эти `промпты` в своем аккаунте `Google Cloud` и открыть `Vertex AI Studio`. Преимущество `Vertex AI Studio` в том, что вы можете настроить `температуру` (`temperature`) и т.д.
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| :-------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**        | `1_bash_rename_files_in_folder`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Goal**        | Написать `промпт` для написания кода на `Bash` для переименования файлов в папке.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Temperature** | 0.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Top-K**       | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Top-P**       | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Prompt**      | Напишите `сниппет кода` (`code snippet`) на `Bash`, который запрашивает имя папки. Затем он берет содержимое папки и переименовывает все файлы внутри, добавляя префикс `draft_` к имени файла.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Output**      | ```bash                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
|                 | #!/bin/bash                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Ask for the folder name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
|                 | echo "Enter the folder name: "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
|                 | read folder_name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Check if the folder exists                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
|                 | if [ ! -d "$folder_name" ]; then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
|                 |   echo "Folder does not exist."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
|                 |   exit 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
|                 | fi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Get the list of files in the folder                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
|                 | files=("$folder_name"/* )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Rename each file by prepending "draft_" to the file name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
|                 | for file in "${files[@]}"; do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 |   new_file_name="draft_$(basename "$file")"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
|                 |   mv "$file" "$new_file_name"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | done                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | echo "Files renamed successfully."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
|                 | ...                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
|                 | ```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

**Таблица 16.** Использование `Gemini` для программирования кода

---

Мне это кажется хорошим кодом - он даже задокументирован! Однако, поскольку `LLM` не могут рассуждать и повторяют обучающие данные (`training data`), важно сначала прочитать и протестировать ваш код.

Момент, которого мы все ждем, действительно ли он работает?
Давайте сначала попробуем с тестовой папкой (`test folder`), содержащей всего несколько файлов, которые нужно будет переименовать из `filename.txt` в `draft_filename.txt`.

1.  Скопируйте вывод (`output`) из Таблицы 16 (без обертки ```bash ... ```) и вставьте его в новый файл с именем `rename_files.sh`.
2.  Откройте окно терминала (`terminal window`) и введите: `./rename_files.sh`. Он попросит ввести имя папки, например, `test`, и нажмите enter.
3.  Скрипт (`script`), похоже, работает нормально. Вы увидите сообщение: **Files renamed successfully.** (Файлы успешно переименованы). Когда вы заглянете в тестовую папку (`test folder`), заметите, что все файлы были идеально переименованы в `draft_filename.txt`.

Сработало!

---

#### Промпты для объяснения кода (`Prompts for explaining code`)

Как разработчик (`developer`), работая в команде, вам приходится читать чужой код (`code`). `Gemini` может помочь вам и с этим. Давайте возьмем вывод кода (`code output`) из Таблицы 16, удалим комментарии и попросим большую языковую модель (`large language model`) объяснить, что происходит. См. Таблицу 17:
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| :-------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**        | `1_bash_explain_the_code`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Goal**        | Написать `промпт` для объяснения кода `Bash`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Temperature** | 0.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Top-K**       | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Top-P**       | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Prompt**      | Объясните мне приведенный ниже код `Bash`:<br>```bash<br>#!/bin/bash<br>echo "Enter the folder name: "<br>read folder_name<br>if [ ! -d "$folder_name" ]; then<br>  echo "Folder does not exist."<br>  exit 1<br>fi<br>files=("$folder_name"/* )<br>for file in "${files[@]}"; do<br>  new_file_name="draft_$(basename "$file")"<br>  mv "$file" "$new_file_name"<br>done<br>echo "Files renamed successfully."<br>...<br>```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Output**      | Этот `Bash скрипт` выполняет следующие задачи:<br>1.  **\*\*Ввод пользователя (`User Input`)\*\***: Он запрашивает у пользователя ввод имени папки с помощью команд `echo` и `read`. Введенное имя папки сохраняется в переменной `folder_name`.<br>2.  **\*\*Проверка существования папки (`Folder Existence Check`)\*\***: Он проверяет, существует ли папка с указанным именем, используя условие `if [ ! -d "$folder_name" ]`. Если папка не существует, он отображает сообщение об ошибке ("Folder does not exist.") и завершает `скрипт` с кодом выхода (`exit code`) 1.<br>3.  **\*\*Получение списка файлов (`File Listing`)\*\***: Он перечисляет все файлы внутри указанной папки с помощью команды `files=("$folder_name"/* )`. Это создает массив (`array`) с именем `files`, содержащий пути ко всем файлам в папке.<br>4.  **\*\*Переименование файлов (`File Renaming`)\*\***: Он итерирует по каждому файлу в массиве `files`, используя цикл `for`. Для каждого файла он генерирует новое имя файла с помощью команды `new_file_name="draft_$(basename "$file")"`. Это новое имя файла создается путем добавления префикса "draft\_" к исходному имени файла. Затем он переименовывает файл с помощью команды `mv "$file" "$new_file_name"`, которая перемещает файл в новое имя.<br>5.  **\*\*Сообщение об успехе (`Success Message`)\*\***: После переименования всех файлов он отображает сообщение об успехе ("Files renamed successfully."), чтобы указать, что операция переименования прошла успешно. |

**Таблица 17.** `Промпт` для объяснения кода
#### Промпты для перевода кода (`Prompts for translating code`)

Код `Bash` из Таблицы 16, кажется, работает нормально. Однако этот `скрипт` мог бы быть действительно переиспользуемым (`reusable`), если бы он запрашивал у меня имена файлов; в идеале он должен работать как отдельное приложение с `UI` (`User Interface`). В качестве отправной точки, `Python` был бы лучшим языком для (веб) приложения, чем `Bash`. `LLM` могут помочь с переводом (`translating`) кода с одного языка на другой. Смотрите пример в Таблице 18:
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| :-------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**        | `1_python_rename_files`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Goal**        | Написать `промпт` для перевода кода `Bash` на `Python`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Temperature** | 0.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Top-K**       | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Top-P**       | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Prompt**      | Переведите приведенный ниже код `Bash` в `сниппет` (`snippet`) `Python`.<br>```bash<br>#!/bin/bash<br>echo "Enter the folder name: "<br>read folder_name<br>if [ ! -d "$folder_name" ]; then<br>  echo "Folder does not exist."<br>  exit 1<br>fi<br>files=("$folder_name"/* )<br>for file in "${files[@]}"; do<br>  new_file_name="draft_$(basename "$file")"<br>  mv "$file" "$new_file_name"<br>done<br>echo "Files renamed successfully."<br>...<br>```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Output**      | ```python                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
|                 | import os                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
|                 | import shutil                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Get the folder name from the user                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
|                 | folder_name = input("Enter the folder name: ")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Check if the folder exists                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
|                 | if not os.path.isdir(folder_name):                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
|                 |     print("Folder does not exist.")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
|                 |     exit(1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Get a list of all files in the folder                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
|                 | files = os.listdir(folder_name)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Iterate over the files                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
|                 | for file in files:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
|                 |     # Create a new file name with the prefix "draft_"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
|                 |     new_file_name = f"draft_{file}"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 |     # Move the file to the new name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
|                 |     shutil.move(os.path.join(folder_name, file),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
|                 |                   os.path.join(folder_name, new_file_name))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
|                 | # Print a success message                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
|                 | print("Files renamed successfully.")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
|                 | ...                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
|                 | ```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

**Таблица 18.** `Промпт` для перевода кода с `Bash` на `Python`
```python
import os
import shutil

folder_name = input("Enter the folder name: ")
prefix = input("Enter the string to prepend to the filename: ")
text = toUpperCase(prefix) # <-- Potential Error: Assuming toUpperCase is defined?

if not os.path.isdir(folder_name):
    print("Folder does not exist.")
    exit(1)

files = os.listdir(folder_name)

for file in files:
    new_filename = f'{text}_{file}' # <-- Corrected f-string syntax

    shutil.move(os.path.join(folder_name, file),
                  os.path.join(folder_name, new_file_name)) # <-- Corrected typo os.path.joi -> os.path.join

print("Files renamed successfully.")
```
Сниппет 3. Сломанный Python скрипт

Доу! (Doh!) Это похоже на баг (bug):
Приведенный ниже код `Python` выдает ошибку (`error`):

```text
Traceback (most recent call last):
  File "/Users/leeboonstra/Documents/test_folder/rename_files.py", line 7,
    in <module>
      text = toUpperCase(prefix)
NameError: name 'toUpperCase' is not defined
```
Сниппет 4.1 Я сломал код Python

Давайте посмотрим, можем ли мы попросить большую языковую модель (large language model) отладить (debug) и проверить (review) код. Взгляните на Таблицу 19:
|                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| :-------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Name**        | `1_python_debug_code`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Goal**        | Написать `промпт` для отладки (`debug`) и проверки (`review`) кода `Python`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Model**       | `gemini-pro`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Temperature** | 0.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Token Limit** | 1024                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Top-K**       | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Top-P**       | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Prompt**      | Приведенный ниже код `Python` выдает ошибку:<br>```text<br>Traceback (most recent call last):<br>  File "/Users/leeboonstra/Documents/test_folder/rename_files.py", line 7,<br>    in <module><br>      text = toUpperCase(prefix)<br>NameError: name 'toUpperCase' is not defined<br>```<br>Отладьте, что не так, и объясните, как я могу улучшить код.<br>```python<br>import os<br>import shutil<br><br># Get the folder name from the user<br>folder_name = input("Enter the folder name: ")<br>prefix = input("Enter the string to prepend to the filename: ")<br>text = toUpperCase(prefix)<br><br># Check if the folder exists<br>if not os.path.isdir(folder_name):<br>    print("Folder does not exist.")<br>    exit(1)<br><br># Get a list of all files in the folder<br>files = os.listdir(folder_name)<br><br># Iterate over the files<br>for file in files:<br>    # Create a new file name with the prefix "draft_"<br>    new_filename = f'{text}_{file}'<br><br>    # Move the file to the new name<br>    shutil.move(os.path.join(folder_name, file),<br>                  os.path.join(folder_name, new_file_name))<br><br>    # Print a success message<br>    print("Files renamed successfully.")<br>...<br>``` |
| **Output**      | Код вызывает функцию `toUpperCase` для преобразования `prefix` в верхний регистр, но эта функция не определена. Чтобы исправить эту проблему, вы можете использовать метод `.upper()` строкового класса, который преобразует данную строку в верхний регистр. Измененный код показан ниже:<br>```python<br>import os<br>import shutil<br><br># Get the folder name from the user<br>folder_name = input("Enter the folder name: ")<br>prefix = input("Enter the string to prepend to the filename: ")<br>text = prefix.upper()<br><br># Check if the folder exists<br>if not os.path.isdir(folder_name):<br>    print("Folder does not exist.")<br>    exit(1)<br><br># Get a list of all files in the folder<br>files = os.listdir(folder_name)<br><br># Iterate over the files<br>for file in files:<br>    # Create a new file name with the prefix "draft_"<br>    new_filename = f'{text}_{file}'<br><br>    # Move the file to the new name<br>    shutil.move(os.path.join(folder_name, file),<br>                  os.path.join(folder_name, new_file_name))<br><br># Print a success message<br>print("Files renamed successfully.")<br>...<br>```<br>Кроме того, есть еще несколько улучшений (`improvements`), которые можно внести в код:<br>1.  Расширение файла (`file extension`) новых имен файлов не сохраняется. Лучше извлечь расширение из исходного имени файла и добавить его к новому имени файла.<br>2.  Код предполагает, что в имени папки нет пробелов (`spaces`). Однако хорошей практикой (`good practice`) является корректная обработка пробелов, заменяя их символами подчеркивания (`underscores`) или дефисами (`hyphens`).<br>3.  Использование синтаксиса `f-строк` (`f' string syntax`) для интерполяции строк (`string interpolation`) более читабельно и лаконично, чем традиционный оператор `+`.<br>4.  Код не обрабатывает ошибки (`handle errors`), которые могут возникнуть в процессе переименования (`renaming process`). Было бы лучше обернуть вызов `shutil.move` в блок `try...except`, чтобы перехватить любые потенциальные ошибки.<br><br>Вот улучшенный код с этими предложениями:<br>```python<br>import os<br>import shutil<br><br># Get the folder name from the user<br>folder_name = input("Enter the folder name: ")<br>prefix = input("Enter the string to prepend to the filename: ")<br><br># Check if the folder exists<br>if not os.path.isdir(folder_name):<br>    print("Folder does not exist.")<br>    exit(1)<br><br># Get a list of all files in the folder<br>files = os.listdir(folder_name)<br><br># Iterate over the files<br>for file in files:<br>    # Get the file extension<br>    ext = os.path.splitext(file)[1]<br><br>    # Create a new file name with the prefix and the file extension<br>    new_filename = f'{prefix}_{os.path.splitext(file)[0]}{ext}'<br><br>    # Build the full paths for the original and new files<br>    old_path = os.path.join(folder_name, file)<br>    new_path = os.path.join(folder_name, new_filename)<br><br>    # Try to move the file<br>    try:<br>        shutil.move(old_path, new_path)<br>    except Exception as e:<br>        print(f"An error occurred while moving the file {file}: {e}")<br><br># Print a success message<br>print("Files renamed successfully.")<br>...<br>```<br>Эти улучшения делают код более надежным (`robust`) и гибким (`flexible`), а также облегчают его чтение и понимание... (Ответ был усечен (`truncated`), поскольку достиг лимита `токенов` (`token limit`). Попробуйте увеличить лимит `токенов`, если вам нужен более длинный ответ.) |

**Таблица 19.** `Промпт` для отладки и проверки кода `Python`
Это здорово. Он не только подсказал мне, как решить проблему, но и выяснил, что в моем коде было больше `багов` (`bugs`), и как их исправить. Последняя часть `промпта` дала предложения по улучшению кода в целом.

---

#### Что насчет мультимодального промптинга? (`What about multimodal prompting?`)

`Промптинг` для кода (`Prompting for code`) по-прежнему использует ту же обычную большую языковую модель (`large language model`). Мультимодальный `промптинг` (`Multimodal prompting`) — это отдельная тема; он относится к технике, при которой вы используете несколько форматов ввода (`multiple input formats`) для управления большой языковой моделью, вместо того чтобы полагаться только на текст. Это может включать комбинации текста (`text`), изображений (`images`), аудио (`audio`), кода (`code`) или даже других форматов (`other formats`), в зависимости от возможностей (`capabilities`) модели и поставленной задачи (`task at hand`).

---

## Лучшие практики (`Best Practices`)

Поиск правильного `промпта` (`prompt`) требует экспериментов (`tinkering`). `Language Studio` в `Vertex AI` — идеальное место для экспериментов с вашими `промптами`, с возможностью тестирования на различных моделях (`various models`).

Используйте следующие лучшие практики (`best practices`), чтобы стать профессионалом (`pro`) в `prompt engineering`.

### Предоставляйте примеры (`Provide examples`)

Самая важная лучшая практика — предоставлять примеры (`one shot` / `few shot`) внутри `промпта`. Это очень эффективно, поскольку действует как мощный инструмент обучения (`teaching tool`). Эти примеры демонстрируют желаемые результаты (`desired outputs`) или схожие ответы (`similar responses`), позволяя модели учиться (`learn`) на них и соответствующим образом адаптировать (`tailor`) свою собственную генерацию. Это все равно что дать модели точку отсчета (`reference point`) или цель (`target`), к которой нужно стремиться, улучшая точность (`accuracy`), стиль (`style`) и тон (`tone`) ее ответа, чтобы лучше соответствовать вашим ожиданиям (`expectations`).
### Дизайн с простотой (`Design with simplicity`)

`Промпты` (`Prompts`) должны быть лаконичными (`concise`), ясными (`clear`) и легкими для понимания (`easy to understand`) как для вас, так и для модели. Как правило (`rule of thumb`), если это уже запутанно для вас, скорее всего, это будет запутанно и для модели. Старайтесь не использовать сложный язык (`complex language`) и не предоставлять ненужную информацию (`unnecessary information`).

**Примеры (`Examples`):**

**ДО (`BEFORE`):**
> Я сейчас посещаю Нью-Йорк, и я хотел бы услышать больше о замечательных местах. Я с двумя 3-летними детьми. Куда нам пойти во время нашего отпуска?

**ПОСЛЕ ПЕРЕРАБОТКИ (`AFTER REWRITE`):**
> Действуй как гид (`travel guide`) для туристов. Опиши замечательные места для посещения в Нью-Йорке, Манхэттен (`New York Manhattan`) с 3-летним ребенком.

Попробуйте использовать глаголы (`verbs`), описывающие действие. Вот набор примеров:

`Act` (Действуй), `Analyze` (Анализируй), `Categorize` (Категоризируй), `Classify` (Классифицируй), `Contrast` (Противопоставляй), `Compare` (Сравнивай), `Create` (Создавай), `Describe` (Описывай), `Define` (Определяй), `Evaluate` (Оценивай), `Extract` (Извлекай), `Find` (Находи), `Generate` (Генерируй), `Identify` (Идентифицируй), `List` (Перечисляй), `Measure` (Измеряй), `Organize` (Организуй), `Parse` (Разбирай), `Pick` (Выбирай), `Predict` (Предсказывай), `Provide` (Предоставляй), `Rank` (Ранжируй), `Recommend` (Рекомендуй), `Return` (Возвращай), `Retrieve` (Извлекай/Находи), `Rewrite` (Переписывай), `Select` (Выбирай), `Show` (Показывай), `Sort` (Сортируй), `Summarize` (Суммируй/Резюмируй), `Translate` (Переводи), `Write` (Пиши).
### Будьте конкретны относительно вывода (`Be specific about the output`)

Будьте конкретны (`specific`) относительно желаемого вывода (`desired output`). Лаконичная инструкция (`concise instruction`) может недостаточно направлять `LLM` или быть слишком общей (`generic`). Предоставление конкретных деталей (`specific details`) в `промпте` (через системный или контекстный `промптинг`) может помочь модели сфокусироваться на том, что релевантно (`relevant`), улучшая общую точность (`overall accuracy`).

**Примеры (`Examples`):**

**ДЕЛАТЬ (`DO`):**
> Сгенерируй пост для блога (`blog post`) из 3 абзацев (`paragraph`) о топ-5 игровых консолях (`video game consoles`). Пост должен быть информативным (`informative`) и увлекательным (`engaging`), и он должен быть написан в разговорном стиле (`conversational style`).

**НЕ ДЕЛАТЬ (`DO NOT`):**
> Сгенерируй пост для блога (`blog post`) об игровых консолях (`video game consoles`).

---

### Используйте инструкции вместо ограничений (`Use Instructions over Constraints`)

Инструкции (`Instructions`) и ограничения (`constraints`) используются в `промптинге` для управления выводом (`output`) `LLM`.

*   **Инструкция (`instruction`)** предоставляет явные указания (`explicit instructions`) относительно желаемого формата (`format`), стиля (`style`) или содержания (`content`) ответа. Она направляет модель в том, что она должна делать или производить.
*   **Ограничение (`constraint`)** — это набор лимитов (`limitations`) или границ (`boundaries`) для ответа. Оно ограничивает то, что модель не должна делать или чего избегать.
Растущие исследования (`Growing research`) показывают, что фокусирование на позитивных инструкциях (`positive instructions`) в `промптинге` может быть более эффективным, чем сильная опора на ограничения (`constraints`). Этот подход согласуется с тем, как люди предпочитают позитивные инструкции спискам того, что делать нельзя.

Инструкции напрямую сообщают желаемый результат (`desired outcome`), тогда как ограничения могут заставить модель гадать о том, что разрешено. Это дает гибкость (`flexibility`) и поощряет креативность (`creativity`) в рамках определенных границ (`defined boundaries`), в то время как ограничения могут лимитировать потенциал (`potential`) модели. Также список ограничений может конфликтовать (`clash`) друг с другом.

Ограничения все еще ценны (`valuable`), но в определенных ситуациях. Чтобы предотвратить генерацию моделью вредоносного (`harmful`) или предвзятого (`biased`) контента, или когда требуется строгий формат (`strict output format`) или стиль (`style`).

Если возможно, используйте позитивные инструкции: вместо того, чтобы говорить модели, что не делать, скажите ей, что делать. Это может избежать путаницы (`confusion`) и улучшить точность (`accuracy`) вывода.

**ДЕЛАТЬ (`DO`):**
> Сгенерируй пост для блога (`blog post`) из 1 абзаца (`paragraph`) о топ-5 игровых консолях (`video game consoles`). Обсуждай только консоль, компанию, которая ее сделала, год и общие продажи (`total sales`).

**НЕ ДЕЛАТЬ (`DO NOT`):**
> Сгенерируй пост для блога (`blog post`) из 1 абзаца (`paragraph`) о топ-5 игровых консолях (`video game consoles`). Не перечисляй названия видеоигр (`video game names`).

Как лучшая практика (`best practice`), начните с приоритизации (`prioritizing`) инструкций, четко указывая, что вы хотите, чтобы модель сделала, и используйте ограничения только тогда, когда это необходимо для безопасности (`safety`), ясности (`clarity`) или специфических требований (`specific requirements`). Экспериментируйте и итерируйте (`Experiment and iterate`), чтобы протестировать различные комбинации инструкций и ограничений, чтобы найти то, что лучше всего работает для ваших конкретных задач (`specific tasks`), и документируйте (`document`) это.
### Контролируйте максимальную длину токенов (`Control the max token length`)

Чтобы контролировать длину (`length`) сгенерированного ответа `LLM` (`generated LLM response`), вы можете либо установить максимальный лимит `токенов` (`max token limit`) в конфигурации (`configuration`), либо явно запросить (`explicitly request`) конкретную длину в вашем `промпте` (`prompt`). Например:

> "Объясни квантовую физику (`quantum physics`) сообщением длиной в твит (`tweet length message`)."

---

### Используйте переменные в промптах (`Use variables in prompts`)

Чтобы повторно использовать `промпты` (`reuse prompts`) и сделать их более динамичными (`dynamic`), используйте переменные (`variables`) в `промпте`, которые можно изменять для разных входных данных (`different inputs`). Например, как показано в Таблице 20, `промпт`, который выдает факты о городе. Вместо `хардкодинга` (`hardcoding`) имени города в `промпте`, используйте переменную. Переменные могут сэкономить вам время и усилия, позволяя избежать повторений. Если вам нужно использовать одну и ту же часть информации в нескольких `промптах`, вы можете сохранить ее в переменной (`variable`), а затем ссылаться (`reference`) на эту переменную в каждом `промпте`. Это имеет большой смысл при интеграции (`integrating`) `промптов` в ваши собственные приложения (`own applications`).

|            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :--------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Prompt** | **ПЕРЕМЕННЫЕ (`VARIABLES`)**<br>`{city}` = "Amsterdam"<br><br>**ПРОМПТ (`PROMPT`)**<br>Вы - гид (`travel guide`). Расскажите мне факт о городе: `{city}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Output** | Амстердам — красивый город, полный каналов, мостов и узких улочек. Это отличное место для посещения благодаря его богатой истории, культуре и ночной жизни. (`Amsterdam is a beautiful city full of canals, bridges, and narrow streets. It's a great place to visit for its rich history, culture, and nightlife.`) |

**Таблица 20.** Использование переменных в `промптах`
### Экспериментируйте с форматами ввода и стилями написания (`Experiment with input formats and writing styles`)

Разные модели (`models`), конфигурации моделей (`model configurations`), форматы `промптов` (`prompt formats`), выбор слов (`word choices`) и отправки (`submits`) могут давать разные результаты. Поэтому важно экспериментировать с атрибутами `промпта` (`prompt attributes`), такими как стиль (`style`), выбор слов (`word choice`) и тип `промпта` (`type prompt`) (`zero shot`, `few shot`, `system prompt`).

Например, `промпт` с целью генерации текста о революционной игровой консоли `Sega Dreamcast` может быть сформулирован как **вопрос (`question`)**, **утверждение (`statement`)** или **инструкция (`instruction`)**, что приведет к разным выводам (`outputs`):

*   **Вопрос:** Что такое `Sega Dreamcast` и почему это была такая революционная консоль?
*   **Утверждение:** `Sega Dreamcast` была игровой консолью шестого поколения (`sixth-generation video game console`), выпущенной `Sega` в 1999 году. Она...
*   **Инструкция:** Напиши один абзац, который описывает консоль `Sega Dreamcast` и объясняет, почему она была такой революционной.

---

### Для few-shot промптинга с задачами классификации, смешивайте классы (`For few-shot prompting with classification tasks, mix up the classes`)

В целом, порядок ваших `few-shot` примеров (`few-shot examples`) не должен иметь большого значения. Однако при выполнении задач классификации (`classification tasks`) убедитесь, что вы смешиваете (`mix up`) возможные классы ответов (`response classes`) в `few-shot` примерах. Это связано с тем, что вы можете непреднамеренно переобучить (`overfitting`) модель под конкретный порядок примеров. Смешивая возможные классы ответов, вы можете гарантировать, что модель учится (`learning`) идентифицировать ключевые особенности (`key features`) каждого класса, а не просто запоминать (`memorizing`) порядок примеров. Это приведет к более надежной (`robust`) и обобщаемой (`generalizable`) производительности (`performance`) на невиданных данных (`unseen data`).
### Адаптируйтесь к обновлениям модели (`Adapt to model updates`)

Важно быть в курсе изменений архитектуры модели (`model architecture`), добавленных данных и возможностей (`capabilities`). Пробуйте новые версии моделей (`newer model versions`) и корректируйте свои `промпты`, чтобы лучше использовать новые возможности (`features`) модели. Инструменты вроде `Vertex AI Studio` отлично подходят для хранения, тестирования и документирования различных версий вашего `промпта`.

---

### Экспериментируйте с форматами вывода (`Experiment with output formats`)

Помимо формата ввода `промпта`, рассмотрите возможность экспериментирования с форматом вывода (`output format`). Для нетворческих задач (`non-creative tasks`), таких как извлечение (`extracting`), выборка (`selecting`), парсинг (`parsing`), упорядочивание (`ordering`), ранжирование (`ranking`) или категоризация (`categorizing`) данных, попробуйте возвращать ваш вывод в структурированном формате (`structured format`), таком как `JSON` или `XML`.

Есть некоторые преимущества в возврате `JSON` объектов из `промпта`, который извлекает данные. В реальном приложении (`real-world application`) мне не нужно вручную создавать этот `JSON` формат, я могу сразу вернуть данные в отсортированном порядке (`sorted order`) (очень удобно при работе с объектами `datetime`), но самое важное — `промптинг` на формат `JSON` заставляет модель создавать структуру и ограничивает `галлюцинации` (`hallucinations`).

В итоге, преимущества использования `JSON` для вашего вывода:

*   Возвращает всегда в одном стиле
*   Фокусируется на данных, которые вы хотите получить
*   Меньше шансов на `галлюцинации` (`hallucinations`)
*   Делает его осведомленным о связях (`relationship aware`)
*   Вы получаете типы данных (`data types`)
*   Вы можете сортировать его

Таблица 4 в разделе `few-shot промптинга` показывает пример того, как возвращать структурированный вывод (`structured output`).
### JSON Repair (Восстановление JSON)

Хотя возврат данных в формате `JSON` предлагает многочисленные преимущества, он не лишен недостатков (`drawbacks`). Структурированная природа (`structured nature`) `JSON`, хотя и полезна для парсинга (`parsing`) и использования в приложениях, требует значительно больше `токенов` (`tokens`), чем обычный текст (`plain text`), что приводит к увеличению времени обработки (`processing time`) и более высоким затратам (`higher costs`). Кроме того, многословность (`verbosity`) `JSON` может легко поглотить все окно вывода (`entire output window`), становясь особенно проблематичной, когда генерация внезапно обрывается (`abruptly cut off`) из-за лимитов `токенов` (`token limits`). Это усечение (`truncation`) часто приводит к невалидному (`invalid`) `JSON`, отсутствию критически важных закрывающих скобок (`crucial closing braces or brackets`), делая вывод непригодным для использования (`unusable`). К счастью, инструменты вроде библиотеки `json-repair` (доступной на `PyPI`) могут быть неоценимы в этих ситуациях. Эта библиотека интеллектуально пытается автоматически исправить (`automatically fix`) неполные (`incomplete`) или некорректные (`malformed`) `JSON` объекты, что делает ее крайне важным союзником при работе с `LLM`-сгенерированным `JSON`, особенно при столкновении с потенциальными проблемами усечения.

---

### Работа со схемами (`Working with Schemas`)

Использование структурированного `JSON` в качестве вывода — отличное решение, как мы уже неоднократно видели в этом документе. Но что насчет ввода (`input`)? Хотя `JSON` превосходен для структурирования вывода, который генерирует `LLM`, он также может быть невероятно полезен для структурирования предоставляемого вами ввода. Именно здесь в игру вступают `JSON` схемы (`JSON Schemas`). `JSON` схема (`JSON Schema`) определяет ожидаемую структуру (`expected structure`) и типы данных (`data types`) вашего `JSON` ввода. Предоставляя схему, вы даете `LLM` четкий план (`clear blueprint`) данных, которые она должна ожидать, помогая ей сфокусировать внимание (`focus its attention`) на релевантной информации и снижая риск неправильной интерпретации (`misinterpreting`) ввода. Кроме того, схемы могут помочь установить связи (`establish relationships`) между различными частями данных и даже сделать `LLM` "осведомленной о времени" (`time-aware`), включив поля даты (`date`) или временной метки (`timestamp`) с определенными форматами (`specific formats`).

Вот простой пример:

Допустим, вы хотите использовать `LLM` для генерации описаний (`descriptions`) продуктов в `e-commerce` каталоге (`catalog`). Вместо того чтобы просто предоставлять произвольное текстовое (`free-form text`) описание продукта, вы можете использовать `JSON` схему для определения атрибутов (`attributes`) продукта:
```json
{
  "type": "object",
  "properties": {
    "name": { "type": "string", "description": "Product name" },
    "category": { "type": "string", "description": "Product category" },
    "price": { "type": "number", "format": "float", "description": "Product price" },
    "features": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Key features of the product"
    },
    "release_date": { "type": "string", "format": "date", "description": "Date the product was released" }
  }
}
```

Сниппет 5. Определение схемы структурированного вывода (`structured output schema`)
Затем вы можете предоставить фактические данные о продукте в виде `JSON` объекта, который соответствует этой схеме (`schema`):

```json
{
  "name": "Wireless Headphones",
  "category": "Electronics",
  "price": 99.99,
  "features": [ "Noise cancellation", "Bluetooth 5.0", "20-hour battery life" ],
  "release_date": "2023-10-27"
}
```

Сниппет 6. Структурированный вывод (`Structured output`) от LLM

Предварительно обрабатывая (`preprocessing`) ваши данные и вместо предоставления полных документов предоставляя как схему (`schema`), так и данные, вы даете `LLM` четкое понимание атрибутов продукта (`product's attributes`), включая дату его выпуска (`release date`), что делает гораздо более вероятным (`likely`) генерацию точного (`accurate`) и релевантного (`relevant`) описания. Этот структурированный подход к вводу (`structured input approach`), направляя внимание `LLM` на релевантные поля (`relevant fields`), особенно ценен при работе с большими объемами данных (`large volumes of data`) или при интеграции `LLM` в сложные приложения (`complex applications`).

---

### Экспериментируйте вместе с другими prompt инженерами (`Experiment together with other prompt engineers`)

Если вы находитесь в ситуации, когда вам нужно придумать хороший `промпт` (`prompt`), вы можете захотеть найти несколько человек для попытки. Когда каждый следует лучшим практикам (`best practices`) (перечисленным в этой главе), вы увидите вариативность (`variance`) в производительности (`performance`) между всеми различными попытками `промптов`.

---

### Лучшие практики CoT (`CoT Best practices`)

Для `CoT промптинга` требуется размещение ответа после рассуждения, потому что генерация рассуждения изменяет `токены`, которые модель получает при предсказании финального ответа.

При `CoT` и самосогласованности (`self-consistency`) вам нужно уметь извлекать финальный ответ (`final answer`) из вашего `промпта`, отделенный от рассуждения.

Для `CoT промптинга` установите `температуру` (`temperature`) на 0.

`Chain of thought промптинг` основан на жадном декодировании (`greedy decoding`), предсказывая следующее слово в последовательности (`sequence`) на основе наивысшей вероятности (`highest probability`), присвоенной языковой моделью. В целом, при использовании рассуждений для получения финального ответа, вероятно, существует только один правильный ответ. Поэтому `температура` всегда должна быть установлена на 0.
### Документируйте различные попытки промптов (`Document the various prompt attempts`)

Последний совет упоминался ранее в этой главе, но мы не можем достаточно подчеркнуть, насколько это важно: документируйте ваши попытки `промптов` (`prompt attempts`) во всех деталях, чтобы вы могли со временем учиться на том, что сработало хорошо, а что нет.

Выводы `промптов` (`Prompt outputs`) могут различаться между моделями (`models`), настройками `сэмплинга` (`sampling settings`) и даже между разными версиями одной и той же модели. Более того, даже при идентичных `промптах` к одной и той же модели могут возникать небольшие различия в форматировании выходных предложений (`output sentence formatting`) и выборе слов (`word choice`). (Например, как упоминалось ранее, если два `токена` имеют одинаковую предсказанную вероятность, ничьи (`ties`) могут быть разрешены случайным образом. Это может повлиять на последующие предсказанные `токены`.)

---

Мы рекомендуем создать `Google Sheet` с Таблицей 21 в качестве шаблона (`template`). Преимущества этого подхода заключаются в том, что у вас будет полная запись (`complete record`), когда вам неизбежно придется пересмотреть свою работу над `промптингом` — либо чтобы взять ее в будущем (вы удивитесь, как много вы можете забыть даже после короткого перерыва), либо для тестирования производительности (`test prompt performance`) `промпта` на разных версиях модели, либо для помощи в отладке будущих ошибок (`debug future errors`).

Помимо полей в этой таблице, также полезно отслеживать версию `промпта` (итерацию - `iteration`), поле для фиксации того, был ли результат OK/NOT OK/SOMETIMES OK, и поле для фиксации обратной связи (`feedback`). Если вам повезло использовать `Vertex AI Studio`, сохраняйте свои `промпты` (используя то же имя и версию, что и в вашей документации) и отслеживайте гиперссылку (`hyperlink`) на сохраненный `промпт` в таблице. Таким образом, вы всегда будете в одном клике от повторного запуска ваших `промптов`.

При работе над системой генерации с дополнением извлечением (`retrieval augmented generation system`, `RAG`), вам также следует фиксировать специфические аспекты системы `RAG`, которые влияют на то, какой контент был вставлен в `промпт`, включая `запрос` (`query`), настройки `чанка` (`chunk settings`), вывод `чанка` (`chunk output`) и другую информацию.

Как только вы почувствуете, что `промпт` близок к идеалу, перенесите его в кодовую базу (`codebase`) вашего проекта. А в кодовой базе сохраняйте `промпты` в отдельном файле от кода, чтобы их было легче поддерживать (`maintain`). Наконец, в идеале ваши `промпты` являются частью операционализированной системы (`operationalized system`), и как `prompt инженер`, вы должны полагаться на автоматизированные тесты (`automated tests`) и процедуры оценки (`evaluation procedures`), чтобы понять, насколько хорошо ваш `промпт` обобщается (`generalizes`) для задачи.

`Prompt engineering` — это итеративный процесс (`iterative process`). Создавайте и тестируйте разные `промпты`, анализируйте и документируйте результаты. Уточняйте (`Refine`) ваш `промпт` на основе производительности модели. Продолжайте экспериментировать, пока не достигнете желаемого вывода (`desired output`). Когда вы меняете модель или конфигурацию модели, возвращайтесь назад и продолжайте экспериментировать с ранее использованными `промптами`.
|                 |                                                                            |
| :-------------- | :------------------------------------------------------------------------- |
| **Name**        | [имя и версия вашего `промпта`]                                           |
| **Goal**        | [объяснение цели этой попытки в одном предложении]                        |
| **Model**       | [имя и версия использованной модели]                                      |
| **Temperature** | [значение от 0 до 1]                                                       |
| **Token Limit** | [число]                                                                    |
| **Top-K**       | [число]                                                                    |
| **Top-P**       | [число]                                                                    |
| **Prompt**      | [Напишите весь полный `промпт`]                                           |
| **Output**      | [Выпишите вывод или несколько выводов]                                  |

**Таблица 21.** Шаблон для документирования `промптов`

---

## Резюме (`Summary`)

Этот `whitepaper` обсуждает `prompt engineering`. Мы изучили различные техники `промптинга`, такие как:

*   `Zero prompting`
*   `Few shot prompting`
*   Системный `промптинг` (`System prompting`)
*   Ролевой `промптинг` (`Role prompting`)
*   Контекстуальный `промптинг` (`Contextual prompting`)
*   `Step-back prompting`
*   `Chain of thought`
*   `Self consistency`
*   `Tree of thoughts`
*   `ReAct`

Мы даже рассмотрели способы автоматизации ваших `промптов`.

Затем `whitepaper` обсуждает вызовы генеративного ИИ (`challenges of gen AI`), такие как проблемы, которые могут возникнуть, когда ваши `промпты` недостаточны. Мы завершили лучшими практиками (`best practices`) о том, как стать лучшим `prompt инженером`.
## Примечания (`Endnotes`)

1.  Google, 2023, `Gemini by Google`. Доступно по адресу: <https://gemini.google.com>
2.  Google, 2024, `Gemini for Google Workspace Prompt Guide`. Доступно по адресу: <https://inthecloud.withgoogle.com/gemini-for-google-workspace-prompt-guide/dl-cd.html>
3.  Google Cloud, 2023, `Introduction to Prompting`. Доступно по адресу: <https://cloud.google.com/vertex-ai/generative-ai/docs/learn/prompts/introduction-prompt-design>
4.  Google Cloud, 2023, `Text Model Request Body: Top-P & top-K sampling methods`. Доступно по адресу: <https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/text#request_body>
5.  Wei, J., et al., 2023, `Zero Shot - Fine tuned language models are zero shot learners`. Доступно по адресу: <https://arxiv.org/pdf/2109.01652.pdf>
6.  Google Cloud, 2023, `Google Cloud Model Garden`. Доступно по адресу: <https://cloud.google.com/model-garden>
7.  Brown, T., et al., 2023, `Few Shot - Language Models are Few Shot learners`. Доступно по адресу: <https://arxiv.org/pdf/2005.14165.pdf>
8.  Zheng, L., et al., 2023, `Take a Step Back: Evoking Reasoning via Abstraction in Large Language Models`. Доступно по адресу: <https://openreview.net/pdf?id=3bq3jsvcQ1>
9.  Wei, J., et al., 2023, `Chain of Thought Prompting`. Доступно по адресу: <https://arxiv.org/pdf/2201.11903.pdf>
10. Google Cloud Platform, 2023, `Chain of Thought and React`. Доступно по адресу: <https://github.com/GoogleCloudPlatform/generative-ai/blob/main/language/prompts/examples/chain_of_thought_react.ipynb>
11. Wang, X., et al., 2023, `Self Consistency Improves Chain of Thought reasoning in language models`. Доступно по адресу: <https://arxiv.org/pdf/2203.11171.pdf>
12. Yao, S., et al., 2023, `Tree of Thoughts: Deliberate Problem Solving with Large Language Models`. Доступно по адресу: <https://arxiv.org/pdf/2305.10601.pdf>
13. Yao, S., et al., 2023, `ReAct: Synergizing Reasoning and Acting in Language Models`. Доступно по адресу: <https://arxiv.org/pdf/2210.03629.pdf>
14. Google Cloud Platform, 2023, `Advance Prompting: Chain of Thought and React`. Доступно по адресу: <https://github.com/GoogleCloudPlatform/applied-ai-engineering-samples/blob/main/genai-on-vertex-ai/advanced_prompting_training/cot_react.ipynb>
15. Zhou, C., et al., 2023, `Automatic Prompt Engineering - Large Language Models are Human-Level Prompt Engineers`. Доступно по адресу: <https://arxiv.org/pdf/2211.01910.pdf>
